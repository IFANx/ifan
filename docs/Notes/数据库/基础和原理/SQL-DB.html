<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>函数依赖 | Notes</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="办法总比问题多">
    
    <link rel="preload" href="/ifan/assets/css/0.styles.449c03be.css" as="style"><link rel="preload" href="/ifan/assets/js/app.b7a83207.js" as="script"><link rel="preload" href="/ifan/assets/js/2.733019b2.js" as="script"><link rel="preload" href="/ifan/assets/js/57.8f24ead4.js" as="script"><link rel="prefetch" href="/ifan/assets/js/10.9d2debbc.js"><link rel="prefetch" href="/ifan/assets/js/11.b851e671.js"><link rel="prefetch" href="/ifan/assets/js/12.01a4958c.js"><link rel="prefetch" href="/ifan/assets/js/13.54ea76bd.js"><link rel="prefetch" href="/ifan/assets/js/14.326484b9.js"><link rel="prefetch" href="/ifan/assets/js/15.f1a70435.js"><link rel="prefetch" href="/ifan/assets/js/16.4803cb84.js"><link rel="prefetch" href="/ifan/assets/js/17.43c1b0bd.js"><link rel="prefetch" href="/ifan/assets/js/18.e2ac850f.js"><link rel="prefetch" href="/ifan/assets/js/19.102411c8.js"><link rel="prefetch" href="/ifan/assets/js/20.8ef4bc05.js"><link rel="prefetch" href="/ifan/assets/js/21.c50c1af9.js"><link rel="prefetch" href="/ifan/assets/js/22.5f797136.js"><link rel="prefetch" href="/ifan/assets/js/23.89937588.js"><link rel="prefetch" href="/ifan/assets/js/24.6f902912.js"><link rel="prefetch" href="/ifan/assets/js/25.b1d549f0.js"><link rel="prefetch" href="/ifan/assets/js/26.6214ac8e.js"><link rel="prefetch" href="/ifan/assets/js/27.50f635b5.js"><link rel="prefetch" href="/ifan/assets/js/28.cb39b596.js"><link rel="prefetch" href="/ifan/assets/js/29.ad95e527.js"><link rel="prefetch" href="/ifan/assets/js/3.825d6b50.js"><link rel="prefetch" href="/ifan/assets/js/30.b8365ea5.js"><link rel="prefetch" href="/ifan/assets/js/31.e1accd69.js"><link rel="prefetch" href="/ifan/assets/js/32.baf74c2c.js"><link rel="prefetch" href="/ifan/assets/js/33.0b9e181d.js"><link rel="prefetch" href="/ifan/assets/js/34.62be2ab7.js"><link rel="prefetch" href="/ifan/assets/js/35.0b44e36f.js"><link rel="prefetch" href="/ifan/assets/js/36.c7b805c8.js"><link rel="prefetch" href="/ifan/assets/js/37.d35b1032.js"><link rel="prefetch" href="/ifan/assets/js/38.05791e80.js"><link rel="prefetch" href="/ifan/assets/js/39.dc1b8498.js"><link rel="prefetch" href="/ifan/assets/js/4.fc333d27.js"><link rel="prefetch" href="/ifan/assets/js/40.757d615e.js"><link rel="prefetch" href="/ifan/assets/js/41.5285d542.js"><link rel="prefetch" href="/ifan/assets/js/42.53e6414a.js"><link rel="prefetch" href="/ifan/assets/js/43.d3e4c0f2.js"><link rel="prefetch" href="/ifan/assets/js/44.deb04dd4.js"><link rel="prefetch" href="/ifan/assets/js/45.7a88852d.js"><link rel="prefetch" href="/ifan/assets/js/46.9c779992.js"><link rel="prefetch" href="/ifan/assets/js/47.7ca21401.js"><link rel="prefetch" href="/ifan/assets/js/48.3c8f875c.js"><link rel="prefetch" href="/ifan/assets/js/49.fd4b04f5.js"><link rel="prefetch" href="/ifan/assets/js/5.bfef3080.js"><link rel="prefetch" href="/ifan/assets/js/50.b122512f.js"><link rel="prefetch" href="/ifan/assets/js/51.774c4c1a.js"><link rel="prefetch" href="/ifan/assets/js/52.fa8ecb9d.js"><link rel="prefetch" href="/ifan/assets/js/53.22975f3f.js"><link rel="prefetch" href="/ifan/assets/js/54.0cc63836.js"><link rel="prefetch" href="/ifan/assets/js/55.5e290f83.js"><link rel="prefetch" href="/ifan/assets/js/56.638d658f.js"><link rel="prefetch" href="/ifan/assets/js/58.b73448da.js"><link rel="prefetch" href="/ifan/assets/js/59.713a6ec0.js"><link rel="prefetch" href="/ifan/assets/js/6.2d0a63f8.js"><link rel="prefetch" href="/ifan/assets/js/60.9f789bdf.js"><link rel="prefetch" href="/ifan/assets/js/61.148f57e2.js"><link rel="prefetch" href="/ifan/assets/js/62.193eef57.js"><link rel="prefetch" href="/ifan/assets/js/63.8ef9a221.js"><link rel="prefetch" href="/ifan/assets/js/64.9d2ce33f.js"><link rel="prefetch" href="/ifan/assets/js/65.09ab09c2.js"><link rel="prefetch" href="/ifan/assets/js/66.cb150ad0.js"><link rel="prefetch" href="/ifan/assets/js/67.5065128e.js"><link rel="prefetch" href="/ifan/assets/js/68.0ec64f84.js"><link rel="prefetch" href="/ifan/assets/js/69.a1b5db2b.js"><link rel="prefetch" href="/ifan/assets/js/7.c8054819.js"><link rel="prefetch" href="/ifan/assets/js/8.54dc58e3.js"><link rel="prefetch" href="/ifan/assets/js/9.0fc958c2.js">
    <link rel="stylesheet" href="/ifan/assets/css/0.styles.449c03be.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/ifan/" class="home-link router-link-active"><!----> <span class="site-name">Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/ifan/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="what?" class="dropdown-title"><span class="title">what?</span> <span class="arrow down"></span></button> <button type="button" aria-label="what?" class="mobile-dropdown-title"><span class="title">what?</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/IFANx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/IFANx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/ifan/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="what?" class="dropdown-title"><span class="title">what?</span> <span class="arrow down"></span></button> <button type="button" aria-label="what?" class="mobile-dropdown-title"><span class="title">what?</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/IFANx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/IFANx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JVM</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Maven</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringBoot</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MySQL</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>操作系统</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Netty</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JUC</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java IO</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>基础和原理</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/ifan/Notes/数据库/基础和原理/记录.html" class="sidebar-link">记录</a></li><li><a href="/ifan/Notes/数据库/基础和原理/SQL-DB.html" class="active sidebar-link">SQL-DB</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ifan/Notes/数据库/基础和原理/SQL-DB.html#函数依赖" class="sidebar-link">函数依赖</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/数据库/基础和原理/SQL-DB.html#异常" class="sidebar-link">[#](#异常) 异常</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/数据库/基础和原理/SQL-DB.html#范式" class="sidebar-link">[#](#范式) 范式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ifan/Notes/数据库/基础和原理/SQL-DB.html#_1-第一范式-1nf" class="sidebar-link">[#](#_1-第一范式-1nf) 1. 第一范式 (1NF)</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/数据库/基础和原理/SQL-DB.html#_2-第二范式-2nf" class="sidebar-link">[#](#_2-第二范式-2nf) 2. 第二范式 (2NF)</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/数据库/基础和原理/SQL-DB.html#_3-第三范式-3nf" class="sidebar-link">[#](#_3-第三范式-3nf) 3. 第三范式 (3NF)</a></li></ul></li><li class="sidebar-sub-header"><a href="/ifan/Notes/数据库/基础和原理/SQL-DB.html#" class="sidebar-link"></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ifan/Notes/数据库/基础和原理/SQL-DB.html#acid" class="sidebar-link">ACID</a></li></ul></li><li class="sidebar-sub-header"><a href="/ifan/Notes/数据库/基础和原理/SQL-DB.html#二、并发一致性问题" class="sidebar-link">二、并发一致性问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ifan/Notes/数据库/基础和原理/SQL-DB.html#丢失修改" class="sidebar-link">[#](#丢失修改) 丢失修改</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/数据库/基础和原理/SQL-DB.html#读脏数据" class="sidebar-link">[#](#读脏数据) 读脏数据</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/数据库/基础和原理/SQL-DB.html#不可重复读" class="sidebar-link">[#](#不可重复读) 不可重复读</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/数据库/基础和原理/SQL-DB.html#幻读" class="sidebar-link">[#](#幻影读) 幻读</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/数据库/基础和原理/SQL-DB.html#封锁协议" class="sidebar-link">封锁协议</a></li></ul></li><li class="sidebar-sub-header"><a href="/ifan/Notes/数据库/基础和原理/SQL-DB.html#四、隔离级别" class="sidebar-link">四、隔离级别</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ifan/Notes/数据库/基础和原理/SQL-DB.html#读未提交-read-uncommitted" class="sidebar-link">[#](#未提交读-read-uncommitted) 读未提交(READ UNCOMMITTED)</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/数据库/基础和原理/SQL-DB.html#提交读-read-committed" class="sidebar-link">[#](#提交读-read-committed) 提交读(READ COMMITTED)</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/数据库/基础和原理/SQL-DB.html#可重复读-repeatable-read" class="sidebar-link">[#](#可重复读-repeatable-read) 可重复读(REPEATABLE READ)</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/数据库/基础和原理/SQL-DB.html#可串行化-serializable" class="sidebar-link">[#](#可串行化-serializable) 可串行化(SERIALIZABLE)</a></li></ul></li><li class="sidebar-sub-header"><a href="/ifan/Notes/数据库/基础和原理/SQL-DB.html#五、多版本并发控制" class="sidebar-link">五、多版本并发控制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ifan/Notes/数据库/基础和原理/SQL-DB.html#版本号" class="sidebar-link">[#](#版本号) 版本号</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/数据库/基础和原理/SQL-DB.html#隐藏的列" class="sidebar-link">[#](#隐藏的列) 隐藏的列</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Notes</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="函数依赖"><a href="#函数依赖" class="header-anchor">#</a> 函数依赖</h2> <blockquote><p>通过函数依赖关系，来帮助你确定表中的合理主外键等；这里只是简介，有这么个概念就可以了，因为大多数情况你不用那些所谓的推倒关系，你也是可以凭借<strong>直觉</strong>设计出来的。</p></blockquote> <p>记 A-&gt;B 表示 A 函数决定 B，也可以说 B 函数依赖于 A。</p> <p>如果 {A1，A2，... ，An} 是关系的一个或多个属性的集合，该集合函数决定了关系的其它所有属性并且是最小的，那么该集合就称为键码。</p> <p>对于 A-&gt;B，如果能找到 A 的真子集 A'，使得 A'-&gt; B，那么 A-&gt;B 就是部分函数依赖，否则就是完全函数依赖。</p> <p>对于 A-&gt;B，B-&gt;C，则 A-&gt;C 是一个传递函数依赖。</p> <h2 id="异常"><a href="#异常" class="header-anchor">#</a> <a href="#%E5%BC%82%E5%B8%B8">#</a> 异常</h2> <blockquote><p>介绍 不符合范式的关系，会产生很多异常，为了引出<strong>范式</strong>的内容。</p></blockquote> <p>以下的学生课程关系的函数依赖为 Sno, Cname -&gt; Sname, Sdept, Mname, Grade，键码为 {Sno, Cname}。也就是说，确定学生和课程之后，就能确定其它信息。</p> <table><thead><tr><th style="text-align:center;">Sno</th> <th style="text-align:center;">Sname</th> <th style="text-align:center;">Sdept</th> <th style="text-align:center;">Mname</th> <th style="text-align:center;">Cname</th> <th style="text-align:center;">Grade</th></tr></thead> <tbody><tr><td style="text-align:center;">1</td> <td style="text-align:center;">学生-1</td> <td style="text-align:center;">学院-1</td> <td style="text-align:center;">院长-1</td> <td style="text-align:center;">课程-1</td> <td style="text-align:center;">90</td></tr> <tr><td style="text-align:center;">2</td> <td style="text-align:center;">学生-2</td> <td style="text-align:center;">学院-2</td> <td style="text-align:center;">院长-2</td> <td style="text-align:center;">课程-2</td> <td style="text-align:center;">80</td></tr> <tr><td style="text-align:center;">2</td> <td style="text-align:center;">学生-2</td> <td style="text-align:center;">学院-2</td> <td style="text-align:center;">院长-2</td> <td style="text-align:center;">课程-1</td> <td style="text-align:center;">100</td></tr> <tr><td style="text-align:center;">3</td> <td style="text-align:center;">学生-3</td> <td style="text-align:center;">学院-2</td> <td style="text-align:center;">院长-2</td> <td style="text-align:center;">课程-2</td> <td style="text-align:center;">95</td></tr></tbody></table> <p>不符合范式的关系，会产生很多异常，主要有以下四种异常:</p> <ul><li>冗余数据: 例如 <code>学生-2</code> 出现了两次。</li> <li>修改异常: 修改了一个记录中的信息，但是另一个记录中相同的信息却没有被修改。</li> <li>删除异常: 删除一个信息，那么也会丢失其它信息。例如删除了 <code>课程-1</code> 需要删除第一行和第三行，那么 <code>学生-1</code> 的信息就会丢失。</li> <li>插入异常: 例如想要插入一个学生的信息，如果这个学生还没选课，那么就无法插入。</li></ul> <h2 id="范式"><a href="#范式" class="header-anchor">#</a> <a href="#%E8%8C%83%E5%BC%8F">#</a> 范式</h2> <blockquote><p>范式理论是为了解决以上提到四种异常。</p></blockquote> <p>高级别范式的依赖于低级别的范式，1NF 是最低级别的范式。</p> <p><img src="/Users/kkxu/NodeProjects/ifan/ifan/images/c2d343f7-604c-4856-9a3c-c71d6f67fecc.png" alt="c2d343f7-604c-4856-9a3c-c71d6f67fecc"></p> <h3 id="_1-第一范式-1nf"><a href="#_1-第一范式-1nf" class="header-anchor">#</a> <a href="#_1-%E7%AC%AC%E4%B8%80%E8%8C%83%E5%BC%8F-1nf">#</a> 1. 第一范式 (1NF)</h3> <p><strong>属性不可分。</strong></p> <h3 id="_2-第二范式-2nf"><a href="#_2-第二范式-2nf" class="header-anchor">#</a> <a href="#_2-%E7%AC%AC%E4%BA%8C%E8%8C%83%E5%BC%8F-2nf">#</a> 2. 第二范式 (2NF)</h3> <p><strong>每个非主属性完全函数依赖于主键。</strong></p> <p>可以通过分解来满足。</p> <p><strong>分解前</strong></p> <table><thead><tr><th style="text-align:center;">Sno</th> <th style="text-align:center;">Sname</th> <th style="text-align:center;">Sdept</th> <th style="text-align:center;">Mname</th> <th style="text-align:center;">Cname</th> <th style="text-align:center;">Grade</th></tr></thead> <tbody><tr><td style="text-align:center;">1</td> <td style="text-align:center;">学生-1</td> <td style="text-align:center;">学院-1</td> <td style="text-align:center;">院长-1</td> <td style="text-align:center;">课程-1</td> <td style="text-align:center;">90</td></tr> <tr><td style="text-align:center;">2</td> <td style="text-align:center;">学生-2</td> <td style="text-align:center;">学院-2</td> <td style="text-align:center;">院长-2</td> <td style="text-align:center;">课程-2</td> <td style="text-align:center;">80</td></tr> <tr><td style="text-align:center;">2</td> <td style="text-align:center;">学生-2</td> <td style="text-align:center;">学院-2</td> <td style="text-align:center;">院长-2</td> <td style="text-align:center;">课程-1</td> <td style="text-align:center;">100</td></tr> <tr><td style="text-align:center;">3</td> <td style="text-align:center;">学生-3</td> <td style="text-align:center;">学院-2</td> <td style="text-align:center;">院长-2</td> <td style="text-align:center;">课程-2</td> <td style="text-align:center;">95</td></tr></tbody></table> <p>以上学生课程关系中，{Sno, Cname} 为键码，有如下函数依赖:</p> <ul><li>Sno -&gt; Sname, Sdept</li> <li>Sdept -&gt; Mname</li> <li>Sno, Cname-&gt; Grade</li></ul> <p>Grade 完全函数依赖于键码，它没有任何冗余数据，每个学生的每门课都有特定的成绩。</p> <p>Sname, Sdept 和 Mname 都部分依赖于键码，当一个学生选修了多门课时，这些数据就会出现多次，造成大量冗余数据。</p> <p><strong>分解后</strong></p> <p>关系-1</p> <table><thead><tr><th style="text-align:center;">Sno</th> <th style="text-align:center;">Sname</th> <th style="text-align:center;">Sdept</th> <th style="text-align:center;">Mname</th></tr></thead> <tbody><tr><td style="text-align:center;">1</td> <td style="text-align:center;">学生-1</td> <td style="text-align:center;">学院-1</td> <td style="text-align:center;">院长-1</td></tr> <tr><td style="text-align:center;">2</td> <td style="text-align:center;">学生-2</td> <td style="text-align:center;">学院-2</td> <td style="text-align:center;">院长-2</td></tr> <tr><td style="text-align:center;">3</td> <td style="text-align:center;">学生-3</td> <td style="text-align:center;">学院-2</td> <td style="text-align:center;">院长-2</td></tr></tbody></table> <p>有以下函数依赖:</p> <ul><li>Sno -&gt; Sname, Sdept</li> <li>Sdept -&gt; Mname</li></ul> <p>关系-2</p> <table><thead><tr><th style="text-align:center;">Sno</th> <th style="text-align:center;">Cname</th> <th style="text-align:center;">Grade</th></tr></thead> <tbody><tr><td style="text-align:center;">1</td> <td style="text-align:center;">课程-1</td> <td style="text-align:center;">90</td></tr> <tr><td style="text-align:center;">2</td> <td style="text-align:center;">课程-2</td> <td style="text-align:center;">80</td></tr> <tr><td style="text-align:center;">2</td> <td style="text-align:center;">课程-1</td> <td style="text-align:center;">100</td></tr> <tr><td style="text-align:center;">3</td> <td style="text-align:center;">课程-2</td> <td style="text-align:center;">95</td></tr></tbody></table> <p>有以下函数依赖:</p> <ul><li>Sno, Cname -&gt; Grade</li></ul> <h3 id="_3-第三范式-3nf"><a href="#_3-第三范式-3nf" class="header-anchor">#</a> <a href="#_3-%E7%AC%AC%E4%B8%89%E8%8C%83%E5%BC%8F-3nf">#</a> 3. 第三范式 (3NF)</h3> <p><strong>非主属性不传递函数依赖于键码。</strong></p> <p>上面的 关系-1 中存在以下传递函数依赖:</p> <ul><li>Sno -&gt; Sdept -&gt; Mname</li></ul> <p>可以进行以下分解:</p> <p>关系-11</p> <table><thead><tr><th style="text-align:center;">Sno</th> <th style="text-align:center;">Sname</th> <th style="text-align:center;">Sdept</th></tr></thead> <tbody><tr><td style="text-align:center;">1</td> <td style="text-align:center;">学生-1</td> <td style="text-align:center;">学院-1</td></tr> <tr><td style="text-align:center;">2</td> <td style="text-align:center;">学生-2</td> <td style="text-align:center;">学院-2</td></tr> <tr><td style="text-align:center;">3</td> <td style="text-align:center;">学生-3</td> <td style="text-align:center;">学院-2</td></tr></tbody></table> <p>关系-12</p> <table><thead><tr><th style="text-align:center;">Sdept</th> <th style="text-align:center;">Mname</th></tr></thead> <tbody><tr><td style="text-align:center;">学院-1</td> <td style="text-align:center;">院长-1</td></tr> <tr><td style="text-align:center;">学院-2</td> <td style="text-align:center;">院长-2</td></tr></tbody></table> <h2 id=""><a href="#" class="header-anchor">#</a></h2> <h3 id="acid"><a href="#acid" class="header-anchor">#</a> ACID</h3> <h4 id="_1-原子性-atomicity"><a href="#_1-原子性-atomicity" class="header-anchor">#</a> <a href="#_1-%E5%8E%9F%E5%AD%90%E6%80%A7-atomicity">#</a> 1. 原子性(Atomicity)</h4> <p>事务被视为不可分割的最小单元，事务的所有操作要么全部提交成功，要么全部失败回滚。</p> <p>回滚可以用日志来实现，日志记录着事务所执行的修改操作，在回滚时反向执行这些修改操作即可。</p> <h4 id="_2-一致性-consistency"><a href="#_2-一致性-consistency" class="header-anchor">#</a> <a href="#_2-%E4%B8%80%E8%87%B4%E6%80%A7-consistency">#</a> 2. 一致性(Consistency)</h4> <p>数据库在事务执行前后都保持一致性状态。在一致性状态下，所有事务对一个数据的读取结果都是相同的。</p> <h4 id="_3-隔离性-isolation"><a href="#_3-隔离性-isolation" class="header-anchor">#</a> <a href="#_3-%E9%9A%94%E7%A6%BB%E6%80%A7-isolation">#</a> 3. 隔离性(Isolation)</h4> <p>一个事务所做的修改在最终提交以前，对其它事务是不可见的。</p> <h4 id="_4-持久性-durability"><a href="#_4-持久性-durability" class="header-anchor">#</a> <a href="#_4-%E6%8C%81%E4%B9%85%E6%80%A7-durability">#</a> 4. 持久性(Durability)</h4> <p>一旦事务提交，则其所做的修改将会永远保存到数据库中。即使系统发生崩溃，事务执行的结果也不能丢失。</p> <p>可以通过数据库备份和恢复来实现，在系统发生崩溃时，使用备份的数据库进行数据恢复。</p> <hr> <p>事务的 ACID 特性概念简单，但不是很好理解，主要是因为这几个特性不是一种平级关系:</p> <ul><li>只有满足一致性，事务的执行结果才是正确的。</li> <li>在无并发的情况下，事务串行执行，隔离性一定能够满足。此时只要能满足原子性，就一定能满足一致性。</li> <li>在并发的情况下，多个事务并行执行，事务不仅要满足原子性，还需要满足隔离性，才能满足一致性。</li> <li>事务满足持久化是为了能应对数据库崩溃的情况。</li></ul> <hr> <h2 id="二、并发一致性问题"><a href="#二、并发一致性问题" class="header-anchor">#</a> 二、并发一致性问题</h2> <p>在并发环境下，事务的隔离性很难保证，因此会出现很多并发一致性问题。</p> <h3 id="丢失修改"><a href="#丢失修改" class="header-anchor">#</a> <a href="#%E4%B8%A2%E5%A4%B1%E4%BF%AE%E6%94%B9">#</a> 丢失修改</h3> <p>T1 和 T2 两个事务都对一个数据进行修改，T1 先修改，T2 随后修改，T2 的修改覆盖了 T1 的修改。</p> <p><img src="/Users/kkxu/NodeProjects/ifan/ifan/images/88ff46b3-028a-4dbb-a572-1f062b8b96d3.png" alt="image"></p> <h3 id="读脏数据"><a href="#读脏数据" class="header-anchor">#</a> <a href="#%E8%AF%BB%E8%84%8F%E6%95%B0%E6%8D%AE">#</a> 读脏数据</h3> <p>T1 修改一个数据，T2 随后读取这个数据。如果 T1 撤销了这次修改，那么 T2 读取的数据是脏数据。</p> <p><img src="/Users/kkxu/NodeProjects/ifan/ifan/images/dd782132-d830-4c55-9884-cfac0a541b8e.png" alt="image"></p> <h3 id="不可重复读"><a href="#不可重复读" class="header-anchor">#</a> <a href="#%E4%B8%8D%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB">#</a> 不可重复读</h3> <p>T2 读取一个数据，T1 对该数据做了修改。如果 T2 再次读取这个数据，此时读取的结果和第一次读取的结果不同。</p> <p><img src="/Users/kkxu/NodeProjects/ifan/ifan/images/c8d18ca9-0b09-441a-9a0c-fb063630d708.png" alt="image"></p> <h3 id="幻读"><a href="#幻读" class="header-anchor">#</a> <a href="#%E5%B9%BB%E5%BD%B1%E8%AF%BB">#</a> 幻读</h3> <p>T1 读取某个范围的数据，T2 在这个范围内插入新的数据，T1 再次读取这个范围的数据，此时读取的结果和和第一次读取的结果不同。</p> <p><img src="/Users/kkxu/NodeProjects/ifan/ifan/images/72fe492e-f1cb-4cfc-92f8-412fb3ae6fec.png" alt="image"></p> <hr> <p>产生并发不一致性问题主要原因是破坏了事务的隔离性，解决方法是通过并发控制来保证隔离性。并发控制可以通过封锁来实现，但是封锁操作需要用户自己控制，相当复杂。数据库管理系统提供了事务的隔离级别，让用户以一种更轻松的方式处理并发一致性问题。</p> <hr> <h3 id="封锁协议"><a href="#封锁协议" class="header-anchor">#</a> 封锁协议</h3> <h4 id="_1-三级封锁协议"><a href="#_1-三级封锁协议" class="header-anchor">#</a> <a href="#_1-%E4%B8%89%E7%BA%A7%E5%B0%81%E9%94%81%E5%8D%8F%E8%AE%AE">#</a> 1. 三级封锁协议</h4> <p><strong>一级封锁协议</strong></p> <p>事务 T 要修改数据 A 时必须加 X 锁，直到 T 结束才释放锁。</p> <p>可以解决丢失修改问题，因为不能同时有两个事务对同一个数据进行修改，那么事务的修改就不会被覆盖。</p> <table><thead><tr><th style="text-align:center;">T1</th> <th style="text-align:center;">T2</th></tr></thead> <tbody><tr><td style="text-align:center;">lock-x(A)</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">read A=20</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">lock-x(A)</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">wait</td></tr> <tr><td style="text-align:center;">write A=19</td> <td style="text-align:center;">.</td></tr> <tr><td style="text-align:center;">commit</td> <td style="text-align:center;">.</td></tr> <tr><td style="text-align:center;">unlock-x(A)</td> <td style="text-align:center;">.</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">obtain</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">read A=19</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">write A=21</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">commit</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">unlock-x(A)</td></tr></tbody></table> <p><strong>二级封锁协议</strong></p> <p>在一级的基础上，要求读取数据 A 时必须加 S 锁，读取完马上释放 S 锁。</p> <p>可以解决读脏数据问题，因为如果一个事务在对数据 A 进行修改，根据 1 级封锁协议，会加 X 锁，那么就不能再加 S 锁了，也就是不会读入数据。</p> <table><thead><tr><th style="text-align:center;">T1</th> <th style="text-align:center;">T2</th></tr></thead> <tbody><tr><td style="text-align:center;">lock-x(A)</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">read A=20</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">write A=19</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">lock-s(A)</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">wait</td></tr> <tr><td style="text-align:center;">rollback</td> <td style="text-align:center;">.</td></tr> <tr><td style="text-align:center;">A=20</td> <td style="text-align:center;">.</td></tr> <tr><td style="text-align:center;">unlock-x(A)</td> <td style="text-align:center;">.</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">obtain</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">read A=20</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">commit</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">unlock-s(A)</td></tr></tbody></table> <p><strong>三级封锁协议</strong></p> <p>在二级的基础上，要求读取数据 A 时必须加 S 锁，直到事务结束了才能释放 S 锁。</p> <p>可以解决不可重复读的问题，因为读 A 时，其它事务不能对 A 加 X 锁，从而避免了在读的期间数据发生改变。</p> <table><thead><tr><th style="text-align:center;">T1</th> <th style="text-align:center;">T2</th></tr></thead> <tbody><tr><td style="text-align:center;">lock-s(A)</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">read A=20</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">lock-x(A)</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">wait</td></tr> <tr><td style="text-align:center;">read A=20</td> <td style="text-align:center;">.</td></tr> <tr><td style="text-align:center;">commit</td> <td style="text-align:center;">.</td></tr> <tr><td style="text-align:center;">unlock-s(A)</td> <td style="text-align:center;">.</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">obtain</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">read A=20</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">write A=19</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">commit</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;">unlock-X(A)</td></tr></tbody></table> <hr> <h2 id="四、隔离级别"><a href="#四、隔离级别" class="header-anchor">#</a> 四、隔离级别</h2> <h3 id="读未提交-read-uncommitted"><a href="#读未提交-read-uncommitted" class="header-anchor">#</a> <a href="#%E6%9C%AA%E6%8F%90%E4%BA%A4%E8%AF%BB-read-uncommitted">#</a> 读未提交(READ UNCOMMITTED)</h3> <p>事务中的修改，即使没有提交，对其它事务也是可见的。</p> <h3 id="提交读-read-committed"><a href="#提交读-read-committed" class="header-anchor">#</a> <a href="#%E6%8F%90%E4%BA%A4%E8%AF%BB-read-committed">#</a> 提交读(READ COMMITTED)</h3> <p>一个事务只能读取已经提交的事务所做的修改。换句话说，一个事务所做的修改在提交之前对其它事务是不可见的。</p> <h3 id="可重复读-repeatable-read"><a href="#可重复读-repeatable-read" class="header-anchor">#</a> <a href="#%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB-repeatable-read">#</a> 可重复读(REPEATABLE READ)</h3> <p>保证在同一个事务中多次读取同样数据的结果是一样的。</p> <h3 id="可串行化-serializable"><a href="#可串行化-serializable" class="header-anchor">#</a> <a href="#%E5%8F%AF%E4%B8%B2%E8%A1%8C%E5%8C%96-serializable">#</a> 可串行化(SERIALIZABLE)</h3> <p>强制事务串行执行。</p> <hr> <table><thead><tr><th style="text-align:center;">隔离级别</th> <th style="text-align:center;">脏读</th> <th style="text-align:center;">不可重复读</th> <th style="text-align:center;">幻影读</th></tr></thead> <tbody><tr><td style="text-align:center;">未提交读</td> <td style="text-align:center;">√</td> <td style="text-align:center;">√</td> <td style="text-align:center;">√</td></tr> <tr><td style="text-align:center;">提交读</td> <td style="text-align:center;">×</td> <td style="text-align:center;">√</td> <td style="text-align:center;">√</td></tr> <tr><td style="text-align:center;">可重复读</td> <td style="text-align:center;">×</td> <td style="text-align:center;">×</td> <td style="text-align:center;">√</td></tr> <tr><td style="text-align:center;">可串行化</td> <td style="text-align:center;">×</td> <td style="text-align:center;">×</td> <td style="text-align:center;">×</td></tr></tbody></table> <hr> <h2 id="五、多版本并发控制"><a href="#五、多版本并发控制" class="header-anchor">#</a> 五、多版本并发控制</h2> <p><strong>多版本并发控制(Multi-Version Concurrency Control, MVCC)是 MySQL 的 InnoDB 存储引擎实现隔离级别的一种具体方式，用于实现提交读和可重复读这两种隔离级别。而未提交读隔离级别总是读取最新的数据行，无需使用 MVCC。可串行化隔离级别需要对所有读取的行都加锁，单纯使用 MVCC 无法实现。</strong></p> <h3 id="版本号"><a href="#版本号" class="header-anchor">#</a> <a href="#%E7%89%88%E6%9C%AC%E5%8F%B7">#</a> 版本号</h3> <ul><li>系统版本号: 是一个递增的数字，每开始一个新的事务，系统版本号就会自动递增。</li> <li>事务版本号: 事务开始时的系统版本号。</li></ul> <h3 id="隐藏的列"><a href="#隐藏的列" class="header-anchor">#</a> <a href="#%E9%9A%90%E8%97%8F%E7%9A%84%E5%88%97">#</a> 隐藏的列</h3> <p>MVCC 在每行记录后面都保存着两个隐藏的列，用来存储两个版本号:</p> <ul><li>创建版本号: 指示创建一个数据行的快照时的系统版本号；</li> <li>删除版本号: 如果该快照的删除版本号大于当前事务版本号表示该快照有效，否则表示该快照已经被删除了。</li></ul> <hr></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/ifan/Notes/数据库/基础和原理/记录.html" class="prev">
        记录
      </a></span> <span class="next"><a href="/ifan/Notes/数据库/编译MySQL源码并执行.html">
        编译MySQL源码并执行
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/ifan/assets/js/app.b7a83207.js" defer></script><script src="/ifan/assets/js/2.733019b2.js" defer></script><script src="/ifan/assets/js/57.8f24ead4.js" defer></script>
  </body>
</html>
