<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>网络层协议-数据平面 | Notes</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="办法总比问题多">
    
    <link rel="preload" href="/ifan/assets/css/0.styles.9066d5db.css" as="style"><link rel="preload" href="/ifan/assets/js/app.4d120860.js" as="script"><link rel="preload" href="/ifan/assets/js/2.733019b2.js" as="script"><link rel="preload" href="/ifan/assets/js/96.4e02925a.js" as="script"><link rel="prefetch" href="/ifan/assets/js/10.8b80ea1e.js"><link rel="prefetch" href="/ifan/assets/js/100.e9c2803e.js"><link rel="prefetch" href="/ifan/assets/js/101.c38eb2ed.js"><link rel="prefetch" href="/ifan/assets/js/11.38c0ff5e.js"><link rel="prefetch" href="/ifan/assets/js/12.b25c7308.js"><link rel="prefetch" href="/ifan/assets/js/13.d78e499d.js"><link rel="prefetch" href="/ifan/assets/js/14.a55dbf23.js"><link rel="prefetch" href="/ifan/assets/js/15.01c694bf.js"><link rel="prefetch" href="/ifan/assets/js/16.d9b12807.js"><link rel="prefetch" href="/ifan/assets/js/17.43c1b0bd.js"><link rel="prefetch" href="/ifan/assets/js/18.fd2a2bd8.js"><link rel="prefetch" href="/ifan/assets/js/19.2ddcd05d.js"><link rel="prefetch" href="/ifan/assets/js/20.efcc37f6.js"><link rel="prefetch" href="/ifan/assets/js/21.81da4056.js"><link rel="prefetch" href="/ifan/assets/js/22.c2eef731.js"><link rel="prefetch" href="/ifan/assets/js/23.7fd291fa.js"><link rel="prefetch" href="/ifan/assets/js/24.7bd49739.js"><link rel="prefetch" href="/ifan/assets/js/25.b220adeb.js"><link rel="prefetch" href="/ifan/assets/js/26.fa9a686d.js"><link rel="prefetch" href="/ifan/assets/js/27.274f0bfc.js"><link rel="prefetch" href="/ifan/assets/js/28.63f7f11e.js"><link rel="prefetch" href="/ifan/assets/js/29.157d2558.js"><link rel="prefetch" href="/ifan/assets/js/3.b90fcfe1.js"><link rel="prefetch" href="/ifan/assets/js/30.5a0fe6f3.js"><link rel="prefetch" href="/ifan/assets/js/31.21730518.js"><link rel="prefetch" href="/ifan/assets/js/32.fb2fce8d.js"><link rel="prefetch" href="/ifan/assets/js/33.f7d48de2.js"><link rel="prefetch" href="/ifan/assets/js/34.ebe83018.js"><link rel="prefetch" href="/ifan/assets/js/35.8a141112.js"><link rel="prefetch" href="/ifan/assets/js/36.caddb5d7.js"><link rel="prefetch" href="/ifan/assets/js/37.99d92d09.js"><link rel="prefetch" href="/ifan/assets/js/38.de0727c0.js"><link rel="prefetch" href="/ifan/assets/js/39.ead0ba96.js"><link rel="prefetch" href="/ifan/assets/js/4.d12742be.js"><link rel="prefetch" href="/ifan/assets/js/40.7f08c50d.js"><link rel="prefetch" href="/ifan/assets/js/41.3e70c717.js"><link rel="prefetch" href="/ifan/assets/js/42.94a42750.js"><link rel="prefetch" href="/ifan/assets/js/43.1e844124.js"><link rel="prefetch" href="/ifan/assets/js/44.15eac3b3.js"><link rel="prefetch" href="/ifan/assets/js/45.a302bb14.js"><link rel="prefetch" href="/ifan/assets/js/46.14719baa.js"><link rel="prefetch" href="/ifan/assets/js/47.11183807.js"><link rel="prefetch" href="/ifan/assets/js/48.7684ee30.js"><link rel="prefetch" href="/ifan/assets/js/49.8997bd21.js"><link rel="prefetch" href="/ifan/assets/js/5.216cae74.js"><link rel="prefetch" href="/ifan/assets/js/50.8fad9f8f.js"><link rel="prefetch" href="/ifan/assets/js/51.fd23ce12.js"><link rel="prefetch" href="/ifan/assets/js/52.f52ac1db.js"><link rel="prefetch" href="/ifan/assets/js/53.7f4d907a.js"><link rel="prefetch" href="/ifan/assets/js/54.925cc9f8.js"><link rel="prefetch" href="/ifan/assets/js/55.3f8e5613.js"><link rel="prefetch" href="/ifan/assets/js/56.e31213c9.js"><link rel="prefetch" href="/ifan/assets/js/57.e2a5b1e9.js"><link rel="prefetch" href="/ifan/assets/js/58.185eb16e.js"><link rel="prefetch" href="/ifan/assets/js/59.5c328590.js"><link rel="prefetch" href="/ifan/assets/js/6.2d0a63f8.js"><link rel="prefetch" href="/ifan/assets/js/60.d4ea69a6.js"><link rel="prefetch" href="/ifan/assets/js/61.69d858b1.js"><link rel="prefetch" href="/ifan/assets/js/62.2e264b63.js"><link rel="prefetch" href="/ifan/assets/js/63.1e680cf2.js"><link rel="prefetch" href="/ifan/assets/js/64.70867694.js"><link rel="prefetch" href="/ifan/assets/js/65.1d88977e.js"><link rel="prefetch" href="/ifan/assets/js/66.2ebab991.js"><link rel="prefetch" href="/ifan/assets/js/67.1b8672de.js"><link rel="prefetch" href="/ifan/assets/js/68.1c7b8840.js"><link rel="prefetch" href="/ifan/assets/js/69.8abe43ae.js"><link rel="prefetch" href="/ifan/assets/js/7.9b5ec1cb.js"><link rel="prefetch" href="/ifan/assets/js/70.742be5c0.js"><link rel="prefetch" href="/ifan/assets/js/71.4dbaf767.js"><link rel="prefetch" href="/ifan/assets/js/72.7910072b.js"><link rel="prefetch" href="/ifan/assets/js/73.7a6b4080.js"><link rel="prefetch" href="/ifan/assets/js/74.d2eca3ca.js"><link rel="prefetch" href="/ifan/assets/js/75.6e3a056c.js"><link rel="prefetch" href="/ifan/assets/js/76.f0870a09.js"><link rel="prefetch" href="/ifan/assets/js/77.f6d5ea7b.js"><link rel="prefetch" href="/ifan/assets/js/78.02268a18.js"><link rel="prefetch" href="/ifan/assets/js/79.0617e287.js"><link rel="prefetch" href="/ifan/assets/js/8.3c3e2ed8.js"><link rel="prefetch" href="/ifan/assets/js/80.077534c8.js"><link rel="prefetch" href="/ifan/assets/js/81.6870dbb5.js"><link rel="prefetch" href="/ifan/assets/js/82.5207812b.js"><link rel="prefetch" href="/ifan/assets/js/83.6454249e.js"><link rel="prefetch" href="/ifan/assets/js/84.67ddf266.js"><link rel="prefetch" href="/ifan/assets/js/85.88236cdb.js"><link rel="prefetch" href="/ifan/assets/js/86.c46c3552.js"><link rel="prefetch" href="/ifan/assets/js/87.f60821ab.js"><link rel="prefetch" href="/ifan/assets/js/88.341c0bd7.js"><link rel="prefetch" href="/ifan/assets/js/89.2aafd1b3.js"><link rel="prefetch" href="/ifan/assets/js/9.46fdf317.js"><link rel="prefetch" href="/ifan/assets/js/90.45375fce.js"><link rel="prefetch" href="/ifan/assets/js/91.ab2444b3.js"><link rel="prefetch" href="/ifan/assets/js/92.ab0dd476.js"><link rel="prefetch" href="/ifan/assets/js/93.627d8f6d.js"><link rel="prefetch" href="/ifan/assets/js/94.d541a56f.js"><link rel="prefetch" href="/ifan/assets/js/95.36b47fa1.js"><link rel="prefetch" href="/ifan/assets/js/97.641df920.js"><link rel="prefetch" href="/ifan/assets/js/98.5cc9551f.js"><link rel="prefetch" href="/ifan/assets/js/99.bfa6f23d.js">
    <link rel="stylesheet" href="/ifan/assets/css/0.styles.9066d5db.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/ifan/" class="home-link router-link-active"><!----> <span class="site-name">Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/ifan/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="what?" class="dropdown-title"><span class="title">what?</span> <span class="arrow down"></span></button> <button type="button" aria-label="what?" class="mobile-dropdown-title"><span class="title">what?</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/IFANx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/IFANx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/ifan/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="what?" class="dropdown-title"><span class="title">what?</span> <span class="arrow down"></span></button> <button type="button" aria-label="what?" class="mobile-dropdown-title"><span class="title">what?</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/IFANx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/IFANx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JVM</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Maven</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>软件测试相关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Redis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringBoot</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>计算机网络</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/ifan/Notes/计算机网络/TCP.html" class="sidebar-link">TCP</a></li><li><a href="/ifan/Notes/计算机网络/UDP.html" class="sidebar-link">UDP</a></li><li><a href="/ifan/Notes/计算机网络/应用层协议.html" class="sidebar-link">应用层协议</a></li><li><a href="/ifan/Notes/计算机网络/HTTP详解.html" class="sidebar-link">HTTP详解</a></li><li><a href="/ifan/Notes/计算机网络/传输层协议.html" class="sidebar-link">传输层协议</a></li><li><a href="/ifan/Notes/计算机网络/RPC.html" class="sidebar-link">RPC</a></li><li><a href="/ifan/Notes/计算机网络/Session和Cookie.html" class="sidebar-link">Session和Cookie</a></li><li><a href="/ifan/Notes/计算机网络/链路层和局域网.html" class="sidebar-link">链路层和局域网</a></li><li><a href="/ifan/Notes/计算机网络/网络层协议-数据平面.html" class="active sidebar-link">网络层协议-数据平面</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ifan/Notes/计算机网络/网络层协议-数据平面.html#转发和路由选择-数据平面和控制平面" class="sidebar-link">转发和路由选择：数据平面和控制平面</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/计算机网络/网络层协议-数据平面.html#路由器工作原理" class="sidebar-link">路由器工作原理</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/计算机网络/网络层协议-数据平面.html#路由器转发策略" class="sidebar-link">路由器转发策略</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/计算机网络/网络层协议-数据平面.html#路由器交换策略" class="sidebar-link">路由器交换策略</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/计算机网络/网络层协议-数据平面.html#网际协议ipv4-ipv6及寻址等" class="sidebar-link">网际协议IPv4，IPv6及寻址等</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ifan/Notes/计算机网络/网络层协议-数据平面.html#ipv4数据报格式" class="sidebar-link">IPv4数据报格式</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/计算机网络/网络层协议-数据平面.html#子网、子网掩码" class="sidebar-link">子网、子网掩码</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/计算机网络/网络层协议-数据平面.html#路由聚合" class="sidebar-link">路由聚合</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/计算机网络/网络层协议-数据平面.html#分类编址-a-b-c-d-四类网络" class="sidebar-link">分类编址（A，B，C, D）四类网络</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/计算机网络/网络层协议-数据平面.html#网络地址转换nat" class="sidebar-link">网络地址转换NAT</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/计算机网络/网络层协议-数据平面.html#ipv6数据报格式" class="sidebar-link">IPv6数据报格式</a></li></ul></li></ul></li><li><a href="/ifan/Notes/计算机网络/网络层协议-控制平面.html" class="sidebar-link">网络层协议-控制平面</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MySQL</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>操作系统</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Netty</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JUC</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Summary</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java IO</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>基础和原理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Notes</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="网络层协议-数据平面"><a href="#网络层协议-数据平面" class="header-anchor">#</a> 网络层协议-数据平面</h1> <h2 id="转发和路由选择-数据平面和控制平面"><a href="#转发和路由选择-数据平面和控制平面" class="header-anchor">#</a> 转发和路由选择：数据平面和控制平面</h2> <p><strong>转发和路由</strong></p> <p>转发：是指将分组从一个输入链路接口转移到 适当的输出链路接口的路由器本地动作。转发发生的时间尺度很短(通常为几纳秒)，因 此通常用硬件来实现。</p> <p>路由选择(routing)：是指确定分组从源到目的地所采取的端到端路 径的网络范围处理过程。路由选择发生的时间尺度长得多(通常为几秒)，因此通常用软 件来实现。</p> <h2 id="路由器工作原理"><a href="#路由器工作原理" class="header-anchor">#</a> 路由器工作原理</h2> <p><img src="http://8.130.25.175:8080/img/image-20230521145900179.png" alt="image-20230521145900179"></p> <p>输入端口。输入端口(input port)执行几项重要功能。它在路由器中执行终结入物 理链路的物理层功能，这显示在图4・4 中输入端口部分最左侧的方框与输出端口部 分最右侧的方框中。</p> <p>交换结构。交换结构将路由器的输入端口连接到它的输岀端口。这种交换结构完全包含在路由器之中，即它是一个网络路由器中的网络!</p> <p>输出端口。输出端口存储从交换结构接收的分组，并通过执行必要的链路层和物理层功能在输出链路上传输这些分组。当一条链路是双向的时(即承载两个方向的流量)，输出端口通常与该链路的输入端口成对出现在同一线路卡上。</p> <p>路由选择处理器。路由选择处理器执行控制平面功能。在传统的路由器中，它执行路由选择协议(我们将在5. 3节和5. 4节学习)，维护路由选择表与关联链路状态 信息，并为该路由器计算转发表。</p> <h2 id="路由器转发策略"><a href="#路由器转发策略" class="header-anchor">#</a> 路由器转发策略</h2> <p><strong>基于目的地的转发</strong></p> <p>输入端口处理和基于目的地转发：转发表是由路由选择处理 器计算和更新的(使用路由选择协议与其他网络路由器中的路由选择处理器进行交 互)，或者转发表接收来自远程SDN控制器的内容。</p> <p><strong>最长前缀匹配规则</strong> ：IP地址前缀匹配：通过匹配IP地址前缀，选择对应的转发端口</p> <p><strong>通用转发</strong></p> <h2 id="路由器交换策略"><a href="#路由器交换策略" class="header-anchor">#</a> 路由器交换策略</h2> <p>交换结构位于一台路由器的核心部位, 因为正是通过这种交换结构, 分组才能实际地 从一个输入端口交换(即转发)到一个输出端口中。</p> <p><img src="http://8.130.25.175:8080/img/image-20230521151005805.png" alt="image-20230521151005805"></p> <ol><li>经内存交换。最简单、最早的路由器是传统的计算机，在输入端口与输出端口之 间的交换是在CPU (路由选择处理器)的直接控制下完成的。</li> <li>经总线交换。在这种方法中，输入端口经一根共享总线将分组直接传送到输出端口，不需要路由选择处理器的干预。</li> <li>经互联网络交换。克服单一、共享式总线带宽限制的一种方法是，使用一个更复杂的互联网络，例如过去在多处理器计算机体系结构中用来互联多个处理器的网 络。纵横式交换机就是一种由2/V条总线组成的互联网络，它连接/V个输入端口 与N个输岀端口，如图4・6所示。每条垂直的总线在交叉点与每条水平的总线交叉, 交叉点通过交换结构控制器(其逻辑是交换结构自身的一部分)能够在任何 时候开启和闭合。当某分组到达端口A,需要转发到端口Y时，交换机控制器闭 合总线A和Y交叉部位的交叉点，然后端口 A在其总线上发送该分组，该分组仅由总线Y接收。注意到来自端口B的一个分组在同一时间能够转发到端口X,因 为 A 到 Y 和 B 到 X 的分组使用不同的输入和输岀总线。</li></ol> <p>因为随着这些队列的增长，路由器的缓存空间最终将会耗尽，并且当无内存可用于存储到达的分组时将会出现<strong>丢包(packet loss)</strong></p> <p><strong>头部阻塞HOL问题</strong>：一个例子，其中在输入队列前端的两个分组(带深色阴影)要发往同一个右上角输出端口。假定该交换结构决 定发送左上角队列前端的分组。在这种 情况下，左下角队列中的深色阴影分组 必须等待。但不仅该分组要等待，左下角队列中排在该分组后面的浅色阴影分 组也要等待，即使右中侧输出端口(浅 色阴影分组的目的地)中无竞争。这种 现象叫作输入排队交换机中的线路前部 (Head-Of-the-Line, HOL)阻塞，即在一 个输入队列中排队的分组必须等待通过交换结构发送(即使输出端口是空闲 的)，因为它被位于线路前部的另一个分 组所阻塞。</p> <p><img src="http://8.130.25.175:8080/img/image-20230521152219627.png" alt="image-20230521152219627"></p> <h2 id="网际协议ipv4-ipv6及寻址等"><a href="#网际协议ipv4-ipv6及寻址等" class="header-anchor">#</a> 网际协议IPv4，IPv6及寻址等</h2> <h3 id="ipv4数据报格式"><a href="#ipv4数据报格式" class="header-anchor">#</a> IPv4数据报格式</h3> <p><img src="http://8.130.25.175:8080/img/image-20230521152842179.png" alt="image-20230521152842179"></p> <p>注意到一个IP数据报有总长为20字节的首部(假设无选项)。如果数据报承载一个TCP报文段，则每个(无分片的)数据报共承载了总长40字节的首部(20字节的IP首 部加上20字节的TCP首部)以及应用层报文。</p> <p><strong>MTU最大传输单元</strong>：一个链路层帧能 承载的最大数据量叫作最大传送单元(Maximum Transmission Unit, MTU) 。</p> <p>IP数据包长度大于MTU时需要分片，IPv4的设计者将标识、标志和片偏移字段放在IP数据报 首部中。当生成一个数据报时，发送主机在为该数据报设置源和目的地址的同时贴上标识号。发送主机通常将它发送的每个数据报的标识号加1。当某路由器需要对一个数据报分 片时，形成的每个数据报(即片)具有初始数据报的源地址、目的地址与标识号。当目的 地从同一发送主机收到一系列数据报时，它能够检查数据报的标识号以确定哪些数据报实 际上是同一较大数据报的片。由于IP是一种不可靠的服务，一个或多个片可能永远到达 不了目的地。因为这种原因，为了让目的主机绝对地相信它已收到了初始数据报的最后一 个片，最后一个片的标志比特被设为0,而所有其他片的标志比特被设为1。另外，为了 让目的主机确定是否丢失了一个片(且能按正确的顺序重新组装片)，使用偏移字段指定该片应放在初始IP数据报的哪个位置。</p> <h3 id="子网、子网掩码"><a href="#子网、子网掩码" class="header-anchor">#</a> 子网、子网掩码</h3> <p>对于一个路由器和主机的通用互联系统，我们能够使用下列有效方法定义系统中的子网:</p> <p>为了确定子网，分开主机和路由器的每个接口，产生几个隔离的网络岛，使 用接口端接这些隔离的网络的端点。这些隔离的网络中的每一个都叫作一个子网</p> <p><img src="http://8.130.25.175:8080/img/image-20230521153722210.png" alt="image-20230521153722210"></p> <p>因特网的地址分配策略被称为<strong>无类别域间路由选择(Classless Inlerdomain Routing, :CIDR)</strong> 。</p> <p><strong>网络前缀表示子网号</strong></p> <h3 id="路由聚合"><a href="#路由聚合" class="header-anchor">#</a> 路由聚合</h3> <p>该ISP (我们称之为Fly- By­Night-ISP) 向外界通告，它应该发送所有地址的前20比特与200. 23. 16. 0/20相符的数据报。外界的其他部分不需要知道在地址块200. 23. 16. 0/20内实际上还存在8个其他 组织，其中每个组织有自己的子网°这种使用单个网络前缀通告多个网络的能力通常称为地址聚合(address aggregation),也称为路由聚合(route aggregation)或路由摘要 (route summarization)。层次路由需要选择<strong>最长前缀匹配规则</strong>来进行子网选择。</p> <p><img src="http://8.130.25.175:8080/img/image-20230521154046295.png" alt="image-20230521154046295"></p> <h3 id="分类编址-a-b-c-d-四类网络"><a href="#分类编址-a-b-c-d-四类网络" class="header-anchor">#</a> 分类编址（A，B，C, D）四类网络</h3> <p>在CIDR被采用之前，IP地址的网络部分被限制为长度为8、16或24比特，这是一种 称为分类编址(classful addressing)的编址方案，这是因为具有8、16和24比特子网地址 的子网分别被称为A、B和C类网络。</p> <p><strong>特殊IP地址</strong>：广播地址：255.255.255.255</p> <p><strong>DHCP协议（动态主机配置协议）</strong>（C-S协议）DHCP服务器</p> <p>某组织一旦获得了一块地址，它就可为本组织内的主机与路由器接口逐个分配IP地 址。系统管理员通常手工配置路由器中的【P地址(常常在远程通过网络管理工具进行配置)。主机地址也能手动配置，但是这项任务目前更多的是使用动态主机配置协议(Dy・ namic Host Configuration, DHCP) [RFC 2131]来完成。DHCP 允许主机自动获取(被分配)一个IP地址。网络管理员能够配置DHCP,以使某给定主机每次与网络连接时能得到 一个相同的IP地址，或者某主机将被分配一个临时的IP地址(tempomry IP address),每 次与网络连接时该地址也许是不同的。除了主机IP地址分配外，DHCP还允许一台主机得 知其他信息，例如它的子网掩码、它的第一跳路由器地址(常称为默认网关)与它的本地 DNS服务器的地址。</p> <p><strong>客户机通过DHCP协议获取动态IP的四个步骤</strong></p> <ol><li><strong>DHCP服务器发现</strong>。一台新到达的主机的首要任务是发现一个要与其交互的DHCP服务器。这可通过使用DHCP发现报文(DHCP discover message)来完成，客户在 UDP分组中向端口 67发送该发现报文。广播地址255.255.255.255</li> <li>DHCP服务器提供。DHCP服务器收到一个DHCP发现报文时，用 DHCP提供报 文(DHCP offer message)向客户做出响应，该报文向该子网的所有节点广播，仍 然使用IP广播地址255. 255. 255. 255 (你也许要思考一下这个服务器为何也必须 采用广播)。因为在子网中可能存在几个DHCP服务器，该客户也许会发现它处于能在几个提供者之间进行选择的优越位置。每台服务器提供的报文包含有收到的 发现报文的事务ID、向客户推荐的IP地址、网络掩码以及IP地址租用期(ad­ dress lease time) , 即IP地址有效的时间量。服务器租用期通常设置为几小时或几 天 [Droms 2002 ] 。</li> <li>DHCP请求。新到达的客户从一个或多个服务器提供中选择一个，并向选中的服 务器提供用DHCP请求报文(DHCP request mess昭e)进行响应，回显配置的 参数。</li> <li>DHCP ACKO 服务器用 DHCP ACK 报文(DHCP ACK message)寸DHCP 请求报文 进行响应，证实所要求的参数。</li></ol> <p><img src="http://8.130.25.175:8080/img/image-20230521154829669.png" alt="image-20230521154829669"></p> <h3 id="网络地址转换nat"><a href="#网络地址转换nat" class="header-anchor">#</a> 网络地址转换NAT</h3> <p><strong>私有地址与公有地址（全球可接入IP）之间的相互转换</strong>（使用NAT地址转换表）广域网IP：port == 局域网 IP：port</p> <p><img src="http://8.130.25.175:8080/img/image-20230521155356604.png" alt="image-20230521155356604"></p> <h3 id="ipv6数据报格式"><a href="#ipv6数据报格式" class="header-anchor">#</a> <strong>IPv6数据报格式</strong></h3> <p><img src="http://8.130.25.175:8080/img/image-20230521155905932.png" alt="image-20230521155905932"></p> <p>扩大的地址容量。IPv6将 IP地址长度从32比特增加到128比特。这就确保32比特 版本流量类型 流标签目的地址(128比特) 全世界将不会用尽IP地址。</p> <p><strong>IPV6相对于IPV4，中间路由器不在具有分片的性质</strong></p> <p>IPv6不允许在中间路由器上进行分片与重新组装。这种操作只能在源与目的地执行。如果路由器收到的IPv6数据报因太大而不能转发到出链路上 的话，则路由器只需丢掉该数据报，并向发送方发回一个“分组太大”的ICMP差错报文即可(见5.6节)。于是发送方能够使用较小长度的IP数据报重发数据。 分片与重新组装是一个耗时的操作，将该功能从路由器中删除并放到端系统中,大大加快了网络中的IP转发速度。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/ifan/Notes/计算机网络/链路层和局域网.html" class="prev">
        链路层和局域网
      </a></span> <span class="next"><a href="/ifan/Notes/计算机网络/网络层协议-控制平面.html">
        网络层协议-控制平面
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/ifan/assets/js/app.4d120860.js" defer></script><script src="/ifan/assets/js/2.733019b2.js" defer></script><script src="/ifan/assets/js/96.4e02925a.js" defer></script>
  </body>
</html>
