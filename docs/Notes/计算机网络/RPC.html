<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>RPC | Notes</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="åŠæ³•æ€»æ¯”é—®é¢˜å¤š">
    
    <link rel="preload" href="/ifan/assets/css/0.styles.9066d5db.css" as="style"><link rel="preload" href="/ifan/assets/js/app.701f64d3.js" as="script"><link rel="preload" href="/ifan/assets/js/2.733019b2.js" as="script"><link rel="preload" href="/ifan/assets/js/64.cc388510.js" as="script"><link rel="prefetch" href="/ifan/assets/js/10.8b80ea1e.js"><link rel="prefetch" href="/ifan/assets/js/11.203b372d.js"><link rel="prefetch" href="/ifan/assets/js/12.a1c93484.js"><link rel="prefetch" href="/ifan/assets/js/13.afa45d57.js"><link rel="prefetch" href="/ifan/assets/js/14.24404345.js"><link rel="prefetch" href="/ifan/assets/js/15.f1a70435.js"><link rel="prefetch" href="/ifan/assets/js/16.5bed06a5.js"><link rel="prefetch" href="/ifan/assets/js/17.52b247ff.js"><link rel="prefetch" href="/ifan/assets/js/18.903829cf.js"><link rel="prefetch" href="/ifan/assets/js/19.d6adfe5b.js"><link rel="prefetch" href="/ifan/assets/js/20.7616c3a8.js"><link rel="prefetch" href="/ifan/assets/js/21.66ae7bb6.js"><link rel="prefetch" href="/ifan/assets/js/22.c185b8bd.js"><link rel="prefetch" href="/ifan/assets/js/23.e4892e4c.js"><link rel="prefetch" href="/ifan/assets/js/24.4c3d389e.js"><link rel="prefetch" href="/ifan/assets/js/25.101a3fb4.js"><link rel="prefetch" href="/ifan/assets/js/26.ce1cdf95.js"><link rel="prefetch" href="/ifan/assets/js/27.50f635b5.js"><link rel="prefetch" href="/ifan/assets/js/28.e7e46d5e.js"><link rel="prefetch" href="/ifan/assets/js/29.bd02d0e3.js"><link rel="prefetch" href="/ifan/assets/js/3.64b6d7b3.js"><link rel="prefetch" href="/ifan/assets/js/30.5992a4c7.js"><link rel="prefetch" href="/ifan/assets/js/31.c1fdfc73.js"><link rel="prefetch" href="/ifan/assets/js/32.04f77474.js"><link rel="prefetch" href="/ifan/assets/js/33.5529f973.js"><link rel="prefetch" href="/ifan/assets/js/34.272f32f7.js"><link rel="prefetch" href="/ifan/assets/js/35.cea109c5.js"><link rel="prefetch" href="/ifan/assets/js/36.c903a40a.js"><link rel="prefetch" href="/ifan/assets/js/37.d35b1032.js"><link rel="prefetch" href="/ifan/assets/js/38.3b345c5b.js"><link rel="prefetch" href="/ifan/assets/js/39.3343bd09.js"><link rel="prefetch" href="/ifan/assets/js/4.d12742be.js"><link rel="prefetch" href="/ifan/assets/js/40.3eeae90f.js"><link rel="prefetch" href="/ifan/assets/js/41.5285d542.js"><link rel="prefetch" href="/ifan/assets/js/42.ab073a5c.js"><link rel="prefetch" href="/ifan/assets/js/43.9c547ca6.js"><link rel="prefetch" href="/ifan/assets/js/44.7568a00a.js"><link rel="prefetch" href="/ifan/assets/js/45.31ccf668.js"><link rel="prefetch" href="/ifan/assets/js/46.b829ec65.js"><link rel="prefetch" href="/ifan/assets/js/47.f68e1966.js"><link rel="prefetch" href="/ifan/assets/js/48.fed3e6be.js"><link rel="prefetch" href="/ifan/assets/js/49.2363e310.js"><link rel="prefetch" href="/ifan/assets/js/5.216cae74.js"><link rel="prefetch" href="/ifan/assets/js/50.94525a39.js"><link rel="prefetch" href="/ifan/assets/js/51.dfc85351.js"><link rel="prefetch" href="/ifan/assets/js/52.64b2cf55.js"><link rel="prefetch" href="/ifan/assets/js/53.d5fcd356.js"><link rel="prefetch" href="/ifan/assets/js/54.57ebcc98.js"><link rel="prefetch" href="/ifan/assets/js/55.ca494eeb.js"><link rel="prefetch" href="/ifan/assets/js/56.e9df4d96.js"><link rel="prefetch" href="/ifan/assets/js/57.30ccdeef.js"><link rel="prefetch" href="/ifan/assets/js/58.ee9b188f.js"><link rel="prefetch" href="/ifan/assets/js/59.b8e17333.js"><link rel="prefetch" href="/ifan/assets/js/6.2d0a63f8.js"><link rel="prefetch" href="/ifan/assets/js/60.8fc6ce71.js"><link rel="prefetch" href="/ifan/assets/js/61.5b56b26d.js"><link rel="prefetch" href="/ifan/assets/js/62.233d2b46.js"><link rel="prefetch" href="/ifan/assets/js/63.ed21c4ce.js"><link rel="prefetch" href="/ifan/assets/js/65.7ded2d6d.js"><link rel="prefetch" href="/ifan/assets/js/66.a03e3811.js"><link rel="prefetch" href="/ifan/assets/js/67.08586f66.js"><link rel="prefetch" href="/ifan/assets/js/68.031a93a5.js"><link rel="prefetch" href="/ifan/assets/js/69.b996c1f2.js"><link rel="prefetch" href="/ifan/assets/js/7.99e44d8f.js"><link rel="prefetch" href="/ifan/assets/js/70.62f92525.js"><link rel="prefetch" href="/ifan/assets/js/71.3e902ff9.js"><link rel="prefetch" href="/ifan/assets/js/72.cf053e3f.js"><link rel="prefetch" href="/ifan/assets/js/8.8da9e55d.js"><link rel="prefetch" href="/ifan/assets/js/9.05495c9e.js">
    <link rel="stylesheet" href="/ifan/assets/css/0.styles.9066d5db.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/ifan/" class="home-link router-link-active"><!----> <span class="site-name">Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/ifan/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="what?" class="dropdown-title"><span class="title">what?</span> <span class="arrow down"></span></button> <button type="button" aria-label="what?" class="mobile-dropdown-title"><span class="title">what?</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/IFANx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/IFANx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/ifan/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="what?" class="dropdown-title"><span class="title">what?</span> <span class="arrow down"></span></button> <button type="button" aria-label="what?" class="mobile-dropdown-title"><span class="title">what?</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/IFANx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/IFANx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JVM</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Maven</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Redis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringBoot</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ•°æ®ç»“æ„</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>è®¡ç®—æœºç½‘ç»œ</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/ifan/Notes/è®¡ç®—æœºç½‘ç»œ/TCP.html" class="sidebar-link">TCP</a></li><li><a href="/ifan/Notes/è®¡ç®—æœºç½‘ç»œ/UDP.html" class="sidebar-link">UDP</a></li><li><a href="/ifan/Notes/è®¡ç®—æœºç½‘ç»œ/åº”ç”¨å±‚åè®®.html" class="sidebar-link">åº”ç”¨å±‚åè®®</a></li><li><a href="/ifan/Notes/è®¡ç®—æœºç½‘ç»œ/HTTPè¯¦è§£.html" class="sidebar-link">HTTPè¯¦è§£</a></li><li><a href="/ifan/Notes/è®¡ç®—æœºç½‘ç»œ/ä¼ è¾“å±‚åè®®.html" class="sidebar-link">ä¼ è¾“å±‚åè®®</a></li><li><a href="/ifan/Notes/è®¡ç®—æœºç½‘ç»œ/RPC.html" class="active sidebar-link">RPC</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ifan/Notes/è®¡ç®—æœºç½‘ç»œ/RPC.html#rpc" class="sidebar-link">RPC</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/è®¡ç®—æœºç½‘ç»œ/RPC.html#_1ã€å®ç°æŠ€æœ¯æ–¹æ¡ˆ" class="sidebar-link">1ã€å®ç°æŠ€æœ¯æ–¹æ¡ˆ</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/è®¡ç®—æœºç½‘ç»œ/RPC.html#_2ã€rpcæ¡†æ¶æ¶æ„" class="sidebar-link">2ã€RPCæ¡†æ¶æ¶æ„</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/è®¡ç®—æœºç½‘ç»œ/RPC.html#_3ã€-å…·ä½“å®ç°" class="sidebar-link">3ã€ å…·ä½“å®ç°</a></li></ul></li><li><a href="/ifan/Notes/è®¡ç®—æœºç½‘ç»œ/é“¾è·¯å±‚å’Œå±€åŸŸç½‘.html" class="sidebar-link">é“¾è·¯å±‚å’Œå±€åŸŸç½‘</a></li><li><a href="/ifan/Notes/è®¡ç®—æœºç½‘ç»œ/ç½‘ç»œå±‚åè®®-æ•°æ®å¹³é¢.html" class="sidebar-link">ç½‘ç»œå±‚åè®®-æ•°æ®å¹³é¢</a></li><li><a href="/ifan/Notes/è®¡ç®—æœºç½‘ç»œ/ç½‘ç»œå±‚åè®®-æ§åˆ¶å¹³é¢.html" class="sidebar-link">ç½‘ç»œå±‚åè®®-æ§åˆ¶å¹³é¢</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MySQL</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ“ä½œç³»ç»Ÿ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Netty</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JUC</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java IO</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>åŸºç¡€å’ŒåŸç†</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ•°æ®åº“</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Notes</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="rpc"><a href="#rpc" class="header-anchor">#</a> RPC</h2> <p>https://www.cnblogs.com/aspirant/p/8631359.html</p> <h4 id="rpcç®€ä»‹"><a href="#rpcç®€ä»‹" class="header-anchor">#</a> <strong>RPCç®€ä»‹</strong></h4> <p>RPCï¼Œå…¨ç§°ä¸ºRemote Procedure Callï¼Œå³è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªè®¡ç®—æœºé€šä¿¡åè®®ã€‚å®ƒå…è®¸åƒè°ƒç”¨æœ¬åœ°æœåŠ¡ä¸€æ ·è°ƒç”¨è¿œç¨‹æœåŠ¡ã€‚å®ƒå¯ä»¥æœ‰ä¸åŒçš„å®ç°æ–¹å¼ã€‚å¦‚RMI(è¿œç¨‹æ–¹æ³•è°ƒç”¨)ã€Hessianã€Http invokerç­‰ã€‚å¦å¤–ï¼ŒRPCæ˜¯ä¸è¯­è¨€æ— å…³çš„ã€‚</p> <h4 id="pcæ¦‚è¿°"><a href="#pcæ¦‚è¿°" class="header-anchor">#</a> <strong>PCæ¦‚è¿°</strong></h4> <p>RPC(Remote Procedure Call)å³è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œå…è®¸ä¸€å°è®¡ç®—æœºè°ƒç”¨å¦ä¸€å°è®¡ç®—æœºä¸Šçš„ç¨‹åºå¾—åˆ°ç»“æœï¼Œè€Œä»£ç ä¸­ä¸éœ€è¦åšé¢å¤–çš„ç¼–ç¨‹ï¼Œå°±åƒåœ¨æœ¬åœ°è°ƒç”¨ä¸€æ ·ã€‚</p> <p>ç°åœ¨äº’è”ç½‘åº”ç”¨çš„é‡çº§è¶Šæ¥è¶Šå¤§ï¼Œå•å°è®¡ç®—æœºçš„èƒ½åŠ›æœ‰é™ï¼Œéœ€è¦å€ŸåŠ©å¯æ‰©å±•çš„è®¡ç®—æœºé›†ç¾¤æ¥å®Œæˆï¼Œåˆ†å¸ƒå¼çš„åº”ç”¨å¯ä»¥å€ŸåŠ©RPCæ¥å®Œæˆæœºå™¨ä¹‹é—´çš„è°ƒç”¨ã€‚</p> <h1 id="ä¸€-rpcæ¡†æ¶åŸç†"><a href="#ä¸€-rpcæ¡†æ¶åŸç†" class="header-anchor">#</a> <strong>ä¸€.RPCæ¡†æ¶åŸç†</strong></h1> <p>åœ¨RPCæ¡†æ¶ä¸­ä¸»è¦æœ‰ä¸‰ä¸ªè§’è‰²ï¼šProviderã€Consumerå’ŒRegistryã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://images2018.cnblogs.com/blog/137084/201805/137084-20180506151205222-740014430.png" alt="img"></p> <p>èŠ‚ç‚¹è§’è‰²è¯´æ˜ï¼š
* Server: æš´éœ²æœåŠ¡çš„æœåŠ¡æä¾›æ–¹ã€‚
* Client: è°ƒç”¨è¿œç¨‹æœåŠ¡çš„æœåŠ¡æ¶ˆè´¹æ–¹ã€‚
* Registry: æœåŠ¡æ³¨å†Œä¸å‘ç°çš„æ³¨å†Œä¸­å¿ƒã€‚</p> <h4 id="rpcç¤ºæ„å›¾"><a href="#rpcç¤ºæ„å›¾" class="header-anchor">#</a> RPCç¤ºæ„å›¾</h4> <p><img src="https://images2015.cnblogs.com/blog/522490/201510/522490-20151003120412386-363334260.png" alt="img"></p> <p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå‡è®¾Computer1åœ¨è°ƒç”¨sayHi()æ–¹æ³•ï¼Œå¯¹äºComputer1è€Œè¨€è°ƒç”¨sayHi()æ–¹æ³•å°±åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ï¼Œè°ƒç”¨ â€“&gt;è¿”å›ã€‚ä½†ä»åç»­è°ƒç”¨å¯ä»¥çœ‹å‡ºComputer1è°ƒç”¨çš„æ˜¯Computer2ä¸­çš„sayHi()æ–¹æ³•ï¼ŒRPCå±è”½äº†åº•å±‚çš„å®ç°ç»†èŠ‚ï¼Œè®©è°ƒç”¨è€…æ— éœ€å…³æ³¨ç½‘ç»œé€šä¿¡ï¼Œæ•°æ®ä¼ è¾“ç­‰ç»†èŠ‚ã€‚</p> <p>ä¸€æ¬¡å®Œæ•´çš„RPCè°ƒç”¨æµç¨‹ï¼ˆåŒæ­¥è°ƒç”¨ï¼Œå¼‚æ­¥å¦è¯´ï¼‰å¦‚ä¸‹ï¼š
1ï¼‰æœåŠ¡æ¶ˆè´¹æ–¹ï¼ˆclientï¼‰è°ƒç”¨ä»¥æœ¬åœ°è°ƒç”¨æ–¹å¼è°ƒç”¨æœåŠ¡ï¼›
2ï¼‰client stubæ¥æ”¶åˆ°è°ƒç”¨åè´Ÿè´£å°†æ–¹æ³•ã€å‚æ•°ç­‰ç»„è£…æˆèƒ½å¤Ÿè¿›è¡Œç½‘ç»œä¼ è¾“çš„æ¶ˆæ¯ä½“ï¼›
3ï¼‰client stubæ‰¾åˆ°æœåŠ¡åœ°å€ï¼Œå¹¶å°†æ¶ˆæ¯å‘é€åˆ°æœåŠ¡ç«¯ï¼›
4ï¼‰server stubæ”¶åˆ°æ¶ˆæ¯åè¿›è¡Œè§£ç ï¼›
5ï¼‰server stubæ ¹æ®è§£ç ç»“æœè°ƒç”¨æœ¬åœ°çš„æœåŠ¡ï¼›
6ï¼‰æœ¬åœ°æœåŠ¡æ‰§è¡Œå¹¶å°†ç»“æœè¿”å›ç»™server stubï¼›
7ï¼‰server stubå°†è¿”å›ç»“æœæ‰“åŒ…æˆæ¶ˆæ¯å¹¶å‘é€è‡³æ¶ˆè´¹æ–¹ï¼›
8ï¼‰client stubæ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œå¹¶è¿›è¡Œè§£ç ï¼›
9ï¼‰æœåŠ¡æ¶ˆè´¹æ–¹å¾—åˆ°æœ€ç»ˆç»“æœã€‚</p> <p>RPCæ¡†æ¶çš„ç›®æ ‡å°±æ˜¯è¦2~8è¿™äº›æ­¥éª¤éƒ½å°è£…èµ·æ¥ï¼Œè®©ç”¨æˆ·å¯¹è¿™äº›ç»†èŠ‚é€æ˜ã€‚</p> <h4 id="æœåŠ¡æ³¨å†Œ-å‘ç°"><a href="#æœåŠ¡æ³¨å†Œ-å‘ç°" class="header-anchor">#</a> æœåŠ¡æ³¨å†Œ&amp;å‘ç°</h4> <p><img src="https://images2018.cnblogs.com/blog/137084/201805/137084-20180506151217061-1795879640.png" alt="img">
æœåŠ¡æä¾›è€…å¯åŠ¨åä¸»åŠ¨å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œæœºå™¨ipã€portä»¥åŠæä¾›çš„æœåŠ¡åˆ—è¡¨ï¼›
æœåŠ¡æ¶ˆè´¹è€…å¯åŠ¨æ—¶å‘æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡æä¾›æ–¹åœ°å€åˆ—è¡¨ï¼Œå¯å®ç°è½¯è´Ÿè½½å‡è¡¡å’ŒFailoverï¼›</p> <p>ä½¿ç”¨åˆ°çš„æŠ€æœ¯</p> <h4 id="_1ã€åŠ¨æ€ä»£ç†"><a href="#_1ã€åŠ¨æ€ä»£ç†" class="header-anchor">#</a> 1ã€åŠ¨æ€ä»£ç†</h4> <p>ç”Ÿæˆ client stubå’Œserver stubéœ€è¦ç”¨åˆ° Java åŠ¨æ€ä»£ç†æŠ€æœ¯ ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨JDKåŸç”Ÿçš„åŠ¨æ€ä»£ç†æœºåˆ¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸€äº›å¼€æºå­—èŠ‚ç å·¥å…·æ¡†æ¶ å¦‚ï¼šCgLibã€Javassistç­‰ã€‚</p> <h4 id="_2ã€åºåˆ—åŒ–"><a href="#_2ã€åºåˆ—åŒ–" class="header-anchor">#</a> 2ã€åºåˆ—åŒ–</h4> <p>ä¸ºäº†èƒ½åœ¨ç½‘ç»œä¸Šä¼ è¾“å’Œæ¥æ”¶ Javaå¯¹è±¡ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å®ƒè¿›è¡Œ åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ“ä½œã€‚
* åºåˆ—åŒ–ï¼šå°†Javaå¯¹è±¡è½¬æ¢æˆbyte[]çš„è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯ç¼–ç çš„è¿‡ç¨‹ï¼›
* ååºåˆ—åŒ–ï¼šå°†byte[]è½¬æ¢æˆJavaå¯¹è±¡çš„è¿‡ç¨‹ï¼›</p> <p>å¯ä»¥ä½¿ç”¨JavaåŸç”Ÿçš„åºåˆ—åŒ–æœºåˆ¶ï¼Œä½†æ˜¯æ•ˆç‡éå¸¸ä½ï¼Œæ¨èä½¿ç”¨ä¸€äº›å¼€æºçš„ã€æˆç†Ÿçš„åºåˆ—åŒ–æŠ€æœ¯ï¼Œä¾‹å¦‚ï¼šprotobufã€Thriftã€hessianã€Kryoã€Msgpack</p> <p>å…³äºåºåˆ—åŒ–å·¥å…·æ€§èƒ½æ¯”è¾ƒå¯ä»¥å‚è€ƒï¼š<a href="https://github.com/eishay/jvm-serializers" target="_blank" rel="noopener noreferrer">jvm-serializers<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="_3ã€nio"><a href="#_3ã€nio" class="header-anchor">#</a> 3ã€NIO</h4> <p>å½“å‰å¾ˆå¤šRPCæ¡†æ¶éƒ½ç›´æ¥åŸºäºnettyè¿™ä¸€IOé€šä¿¡æ¡†æ¶ï¼Œæ¯”å¦‚é˜¿é‡Œå·´å·´çš„HSFã€dubboï¼ŒHadoop Avroï¼Œæ¨èä½¿ç”¨Netty ä½œä¸ºåº•å±‚é€šä¿¡æ¡†æ¶ã€‚</p> <h4 id="_4ã€æœåŠ¡æ³¨å†Œä¸­å¿ƒ"><a href="#_4ã€æœåŠ¡æ³¨å†Œä¸­å¿ƒ" class="header-anchor">#</a> 4ã€æœåŠ¡æ³¨å†Œä¸­å¿ƒ</h4> <p>å¯é€‰æŠ€æœ¯ï¼š
* Redis
* Zookeeper
* Consul
* Etcd</p> <h1 id="äºŒã€rpcæ¡†æ¶çš„å®ç°"><a href="#äºŒã€rpcæ¡†æ¶çš„å®ç°" class="header-anchor">#</a> äºŒã€RPCæ¡†æ¶çš„å®ç°</h1> <p>ä¸Šé¢ä»‹ç»äº†RPCçš„æ ¸å¿ƒåŸç†ï¼šRPCèƒ½å¤Ÿè®©æœ¬åœ°åº”ç”¨ç®€å•ã€é«˜æ•ˆåœ°è°ƒç”¨æœåŠ¡å™¨ä¸­çš„è¿‡ç¨‹ï¼ˆæœåŠ¡ï¼‰ã€‚å®ƒä¸»è¦åº”ç”¨åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿã€‚å¦‚Hadoopä¸­çš„IPCç»„ä»¶ã€‚ä½†æ€æ ·å®ç°ä¸€ä¸ªRPCæ¡†æ¶å‘¢ï¼Ÿ</p> <p>ä»ä¸‹é¢å‡ ä¸ªæ–¹é¢æ€è€ƒï¼Œä»…ä¾›å‚è€ƒï¼š</p> <p>1.é€šä¿¡æ¨¡å‹ï¼šå‡è®¾é€šä¿¡çš„ä¸ºAæœºå™¨ä¸Bæœºå™¨ï¼ŒAä¸Bä¹‹é—´æœ‰é€šä¿¡æ¨¡å‹ï¼Œåœ¨Javaä¸­ä¸€èˆ¬åŸºäºBIOæˆ–NIOï¼›ã€‚</p> <p>2.è¿‡ç¨‹ï¼ˆæœåŠ¡ï¼‰å®šä½ï¼šä½¿ç”¨ç»™å®šçš„é€šä¿¡æ–¹å¼ï¼Œä¸ç¡®å®šIPä¸ç«¯å£åŠæ–¹æ³•åç§°ç¡®å®šå…·ä½“çš„è¿‡ç¨‹æˆ–æ–¹æ³•ï¼›</p> <p>3.è¿œç¨‹ä»£ç†å¯¹è±¡ï¼šæœ¬åœ°è°ƒç”¨çš„æ–¹æ³•(æœåŠ¡)å…¶å®æ˜¯è¿œç¨‹æ–¹æ³•çš„æœ¬åœ°ä»£ç†ï¼Œå› æ­¤å¯èƒ½éœ€è¦ä¸€ä¸ªè¿œç¨‹ä»£ç†å¯¹è±¡ï¼Œå¯¹äºJavaè€Œè¨€ï¼Œè¿œç¨‹ä»£ç†å¯¹è±¡å¯ä»¥ä½¿ç”¨Javaçš„åŠ¨æ€å¯¹è±¡å®ç°ï¼Œå°è£…äº†è°ƒç”¨è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼›</p> <p>4.åºåˆ—åŒ–ï¼Œå°†å¯¹è±¡åç§°ã€æ–¹æ³•åç§°ã€å‚æ•°ç­‰å¯¹è±¡ä¿¡æ¯è¿›è¡Œç½‘ç»œä¼ è¾“éœ€è¦è½¬æ¢æˆäºŒè¿›åˆ¶ä¼ è¾“ï¼Œè¿™é‡Œå¯èƒ½éœ€è¦ä¸åŒçš„åºåˆ—åŒ–æŠ€æœ¯æ–¹æ¡ˆã€‚å¦‚:protobufï¼ŒArvoç­‰ã€‚</p> <h1 id="ä¸‰ã€javaå®ç°rpcæ¡†æ¶"><a href="#ä¸‰ã€javaå®ç°rpcæ¡†æ¶" class="header-anchor">#</a> ä¸‰ã€Javaå®ç°RPCæ¡†æ¶</h1> <h2 id="_1ã€å®ç°æŠ€æœ¯æ–¹æ¡ˆ"><a href="#_1ã€å®ç°æŠ€æœ¯æ–¹æ¡ˆ" class="header-anchor">#</a> 1ã€å®ç°æŠ€æœ¯æ–¹æ¡ˆ</h2> <p>ä¸‹é¢ä½¿ç”¨æ¯”è¾ƒåŸå§‹çš„æ–¹æ¡ˆå®ç°RPCæ¡†æ¶ï¼Œé‡‡ç”¨Socketé€šä¿¡ã€åŠ¨æ€ä»£ç†ä¸åå°„ä¸JavaåŸç”Ÿçš„åºåˆ—åŒ–ã€‚</p> <h2 id="_2ã€rpcæ¡†æ¶æ¶æ„"><a href="#_2ã€rpcæ¡†æ¶æ¶æ„" class="header-anchor">#</a> 2ã€RPCæ¡†æ¶æ¶æ„</h2> <p>RPCæ¶æ„åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š</p> <p>1ï¼‰æœåŠ¡æä¾›è€…ï¼Œè¿è¡Œåœ¨æœåŠ¡å™¨ç«¯ï¼Œæä¾›æœåŠ¡æ¥å£å®šä¹‰ä¸æœåŠ¡å®ç°ç±»ã€‚</p> <p>2ï¼‰æœåŠ¡ä¸­å¿ƒï¼Œè¿è¡Œåœ¨æœåŠ¡å™¨ç«¯ï¼Œè´Ÿè´£å°†æœ¬åœ°æœåŠ¡å‘å¸ƒæˆè¿œç¨‹æœåŠ¡ï¼Œç®¡ç†è¿œç¨‹æœåŠ¡ï¼Œæä¾›ç»™æœåŠ¡æ¶ˆè´¹è€…ä½¿ç”¨ã€‚</p> <p>3ï¼‰æœåŠ¡æ¶ˆè´¹è€…ï¼Œè¿è¡Œåœ¨å®¢æˆ·ç«¯ï¼Œé€šè¿‡è¿œç¨‹ä»£ç†å¯¹è±¡è°ƒç”¨è¿œç¨‹æœåŠ¡ã€‚</p> <h2 id="_3ã€-å…·ä½“å®ç°"><a href="#_3ã€-å…·ä½“å®ç°" class="header-anchor">#</a> 3ã€ å…·ä½“å®ç°</h2> <p>æœåŠ¡æä¾›è€…æ¥å£å®šä¹‰ä¸å®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">HelloService</span> <span class="token punctuation">{</span>
 
    <span class="token class-name">String</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token punctuation">}</span>
</code></pre></div><p>HelloServicesæ¥å£å®ç°ç±»ï¼š</p> <p>[<img src="https://common.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç ">](javascript:void(0)ğŸ˜‰</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">HelloService</span> <span class="token punctuation">{</span>
 
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Hi, &quot;</span> <span class="token operator">+</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
<span class="token punctuation">}</span>
</code></pre></div><p>[<img src="https://common.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç ">](javascript:void(0)ğŸ˜‰</p> <p>æœåŠ¡ä¸­å¿ƒä»£ç å®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p> <p>[<img src="https://common.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç ">](javascript:void(0)ğŸ˜‰</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Server</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span>
 
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">Class</span> serviceInterface<span class="token punctuation">,</span> <span class="token class-name">Class</span> impl<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isRunning</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>[<img src="https://common.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç ">](javascript:void(0)ğŸ˜‰</p> <p>æœåŠ¡ä¸­å¿ƒå®ç°ç±»ï¼š</p> <p>[<img src="https://common.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç ">](javascript:void(0)ğŸ˜‰</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServiceCenter</span> <span class="token keyword">implements</span> <span class="token class-name">Server</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> executor <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">availableProcessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token punctuation">&gt;</span></span> serviceRegistry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> isRunning <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
 
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> port<span class="token punctuation">;</span>
 
    <span class="token keyword">public</span> <span class="token class-name">ServiceCenter</span><span class="token punctuation">(</span><span class="token keyword">int</span> port<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>port <span class="token operator">=</span> port<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        isRunning <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        executor<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">ServerSocket</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        server<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;start server&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 1.ç›‘å¬å®¢æˆ·ç«¯çš„TCPè¿æ¥ï¼Œæ¥åˆ°TCPè¿æ¥åå°†å…¶å°è£…æˆtaskï¼Œç”±çº¿ç¨‹æ± æ‰§è¡Œ</span>
                executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ServiceTask</span><span class="token punctuation">(</span>server<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            server<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
 
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">Class</span> serviceInterface<span class="token punctuation">,</span> <span class="token class-name">Class</span> impl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        serviceRegistry<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>serviceInterface<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> impl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isRunning</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> isRunning<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> port<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ServiceTask</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
        <span class="token class-name">Socket</span> clent <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
 
        <span class="token keyword">public</span> <span class="token class-name">ServiceTask</span><span class="token punctuation">(</span><span class="token class-name">Socket</span> client<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>clent <span class="token operator">=</span> client<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
 
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">ObjectInputStream</span> input <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token class-name">ObjectOutputStream</span> output <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// 2.å°†å®¢æˆ·ç«¯å‘é€çš„ç æµååºåˆ—åŒ–æˆå¯¹è±¡ï¼Œåå°„è°ƒç”¨æœåŠ¡å®ç°è€…ï¼Œè·å–æ‰§è¡Œç»“æœ</span>
                input <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span>clent<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> serviceName <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> methodName <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> parameterTypes <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> input<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arguments <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> input<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Class</span> serviceClass <span class="token operator">=</span> serviceRegistry<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>serviceName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>serviceClass <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">(</span>serviceName <span class="token operator">+</span> <span class="token string">&quot; not found&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">Method</span> method <span class="token operator">=</span> serviceClass<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>methodName<span class="token punctuation">,</span> parameterTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Object</span> result <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>serviceClass<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
                <span class="token comment">// 3.å°†æ‰§è¡Œç»“æœååºåˆ—åŒ–ï¼Œé€šè¿‡socketå‘é€ç»™å®¢æˆ·ç«¯</span>
                output <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span>clent<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                output<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>output <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        output<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>input <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        input<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>clent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        clent<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
 
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>[<img src="https://common.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç ">](javascript:void(0)ğŸ˜‰</p> <p>å®¢æˆ·ç«¯çš„è¿œç¨‹ä»£ç†å¯¹è±¡ï¼š</p> <p>[<img src="https://common.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç ">](javascript:void(0)ğŸ˜‰</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RPCClient</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getRemoteProxyObj</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> serviceInterface<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">InetSocketAddress</span> addr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1.å°†æœ¬åœ°çš„æ¥å£è°ƒç”¨è½¬æ¢æˆJDKçš„åŠ¨æ€ä»£ç†ï¼Œåœ¨åŠ¨æ€ä»£ç†ä¸­å®ç°æ¥å£çš„è¿œç¨‹è°ƒç”¨</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>serviceInterface<span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>serviceInterface<span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">InvocationHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
                        <span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                        <span class="token class-name">ObjectOutputStream</span> output <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                        <span class="token class-name">ObjectInputStream</span> input <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                        <span class="token keyword">try</span> <span class="token punctuation">{</span>
                            <span class="token comment">// 2.åˆ›å»ºSocketå®¢æˆ·ç«¯ï¼Œæ ¹æ®æŒ‡å®šåœ°å€è¿æ¥è¿œç¨‹æœåŠ¡æä¾›è€…</span>
                            socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            socket<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
                            <span class="token comment">// 3.å°†è¿œç¨‹æœåŠ¡è°ƒç”¨æ‰€éœ€çš„æ¥å£ç±»ã€æ–¹æ³•åã€å‚æ•°åˆ—è¡¨ç­‰ç¼–ç åå‘é€ç»™æœåŠ¡æä¾›è€…</span>
                            output <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            output<span class="token punctuation">.</span><span class="token function">writeUTF</span><span class="token punctuation">(</span>serviceInterface<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            output<span class="token punctuation">.</span><span class="token function">writeUTF</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            output<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getParameterTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            output<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
                            <span class="token comment">// 4.åŒæ­¥é˜»å¡ç­‰å¾…æœåŠ¡å™¨è¿”å›åº”ç­”ï¼Œè·å–åº”ç­”åè¿”å›</span>
                            input <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">return</span> input<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>socket <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>output <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> output<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>input <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> input<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>[<img src="https://common.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç ">](javascript:void(0)ğŸ˜‰</p> <p>æœ€åä¸ºæµ‹è¯•ç±»ï¼š</p> <p>[<img src="https://common.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç ">](javascript:void(0)ğŸ˜‰</p> <div class="language- extra-class"><pre class="language-text"><code>public class RPCTest {
 
    public static void main(String[] args) throws IOException {
        new Thread(new Runnable() {
            public void run() {
                try {
                    Server serviceServer = new ServiceCenter(8088);
                    serviceServer.register(HelloService.class, HelloServiceImpl.class);
                    serviceServer.start();
                } catch (IOException e) {
                    e.printStackTrace();
                }
            }
        }).start();
        HelloService service = RPCClient.getRemoteProxyObj(HelloService.class, new InetSocketAddress(&quot;localhost&quot;, 8088));
        System.out.println(service.sayHi(&quot;test&quot;));
    }
}
</code></pre></div><p>[<img src="https://common.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç ">](javascript:void(0)ğŸ˜‰</p> <p>è¿è¡Œç»“æœï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code>regeist service <span class="token class-name">HelloService</span>
start server
<span class="token class-name">Hi</span><span class="token punctuation">,</span> test
</code></pre></div><h1 id="å››ã€æ€»ç»“"><a href="#å››ã€æ€»ç»“" class="header-anchor">#</a> å››ã€æ€»ç»“</h1> <p>RPCæœ¬è´¨ä¸ºæ¶ˆæ¯å¤„ç†æ¨¡å‹ï¼ŒRPCå±è”½äº†åº•å±‚ä¸åŒä¸»æœºé—´çš„é€šä¿¡ç»†èŠ‚ï¼Œè®©è¿›ç¨‹è°ƒç”¨è¿œç¨‹çš„æœåŠ¡å°±åƒæ˜¯æœ¬åœ°çš„æœåŠ¡ä¸€æ ·ã€‚</p> <h1 id="äº”ã€å¯ä»¥æ”¹è¿›çš„åœ°æ–¹"><a href="#äº”ã€å¯ä»¥æ”¹è¿›çš„åœ°æ–¹" class="header-anchor">#</a> äº”ã€å¯ä»¥æ”¹è¿›çš„åœ°æ–¹</h1> <p>è¿™é‡Œå®ç°çš„ç®€å•RPCæ¡†æ¶æ˜¯ä½¿ç”¨Javaè¯­è¨€å¼€å‘ï¼Œä¸Javaè¯­è¨€é«˜åº¦è€¦åˆï¼Œå¹¶ä¸”é€šä¿¡æ–¹å¼é‡‡ç”¨çš„Socketæ˜¯åŸºäºBIOå®ç°çš„ï¼ŒIOæ•ˆç‡ä¸é«˜ï¼Œè¿˜æœ‰JavaåŸç”Ÿçš„åºåˆ—åŒ–æœºåˆ¶å å†…å­˜å¤ªå¤šï¼Œè¿è¡Œæ•ˆç‡ä¹Ÿä¸é«˜ã€‚å¯ä»¥è€ƒè™‘ä»ä¸‹é¢å‡ ç§æ–¹æ³•æ”¹è¿›ã€‚</p> <ol><li>å¯ä»¥é‡‡ç”¨åŸºäºJSONæ•°æ®ä¼ è¾“çš„RPCæ¡†æ¶ï¼›</li> <li>å¯ä»¥ä½¿ç”¨NIOæˆ–ç›´æ¥ä½¿ç”¨Nettyæ›¿ä»£BIOå®ç°ï¼›</li> <li>ä½¿ç”¨å¼€æºçš„åºåˆ—åŒ–æœºåˆ¶ï¼Œå¦‚Hadoop Avroä¸Google protobufç­‰ï¼›</li> <li>æœåŠ¡æ³¨å†Œå¯ä»¥ä½¿ç”¨Zookeeperè¿›è¡Œç®¡ç†ï¼Œèƒ½å¤Ÿè®©åº”ç”¨æ›´åŠ ç¨³å®šã€‚</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/ifan/Notes/è®¡ç®—æœºç½‘ç»œ/ä¼ è¾“å±‚åè®®.html" class="prev">
        ä¼ è¾“å±‚åè®®
      </a></span> <span class="next"><a href="/ifan/Notes/è®¡ç®—æœºç½‘ç»œ/é“¾è·¯å±‚å’Œå±€åŸŸç½‘.html">
        é“¾è·¯å±‚å’Œå±€åŸŸç½‘
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/ifan/assets/js/app.701f64d3.js" defer></script><script src="/ifan/assets/js/2.733019b2.js" defer></script><script src="/ifan/assets/js/64.cc388510.js" defer></script>
  </body>
</html>
