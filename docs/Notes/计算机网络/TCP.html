<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>TCP | Notes</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="办法总比问题多">
    
    <link rel="preload" href="/ifan/assets/css/0.styles.9066d5db.css" as="style"><link rel="preload" href="/ifan/assets/js/app.5185ce44.js" as="script"><link rel="preload" href="/ifan/assets/js/2.733019b2.js" as="script"><link rel="preload" href="/ifan/assets/js/81.b9c602ba.js" as="script"><link rel="prefetch" href="/ifan/assets/js/10.79d5a438.js"><link rel="prefetch" href="/ifan/assets/js/11.b481b7e3.js"><link rel="prefetch" href="/ifan/assets/js/12.a1c93484.js"><link rel="prefetch" href="/ifan/assets/js/13.d78e499d.js"><link rel="prefetch" href="/ifan/assets/js/14.15948a8d.js"><link rel="prefetch" href="/ifan/assets/js/15.c18a4b22.js"><link rel="prefetch" href="/ifan/assets/js/16.d9b12807.js"><link rel="prefetch" href="/ifan/assets/js/17.43c1b0bd.js"><link rel="prefetch" href="/ifan/assets/js/18.9380aec3.js"><link rel="prefetch" href="/ifan/assets/js/19.102411c8.js"><link rel="prefetch" href="/ifan/assets/js/20.ed15f5e6.js"><link rel="prefetch" href="/ifan/assets/js/21.02650e7a.js"><link rel="prefetch" href="/ifan/assets/js/22.ef623e7a.js"><link rel="prefetch" href="/ifan/assets/js/23.a4fce679.js"><link rel="prefetch" href="/ifan/assets/js/24.14136b12.js"><link rel="prefetch" href="/ifan/assets/js/25.e6c33905.js"><link rel="prefetch" href="/ifan/assets/js/26.6214ac8e.js"><link rel="prefetch" href="/ifan/assets/js/27.9ba814fb.js"><link rel="prefetch" href="/ifan/assets/js/28.1f3bc1bc.js"><link rel="prefetch" href="/ifan/assets/js/29.ad95e527.js"><link rel="prefetch" href="/ifan/assets/js/3.e0f7b2b3.js"><link rel="prefetch" href="/ifan/assets/js/30.5992a4c7.js"><link rel="prefetch" href="/ifan/assets/js/31.c1fdfc73.js"><link rel="prefetch" href="/ifan/assets/js/32.ae083fb8.js"><link rel="prefetch" href="/ifan/assets/js/33.0b9e181d.js"><link rel="prefetch" href="/ifan/assets/js/34.272f32f7.js"><link rel="prefetch" href="/ifan/assets/js/35.929b39e7.js"><link rel="prefetch" href="/ifan/assets/js/36.226bf518.js"><link rel="prefetch" href="/ifan/assets/js/37.7665d111.js"><link rel="prefetch" href="/ifan/assets/js/38.05791e80.js"><link rel="prefetch" href="/ifan/assets/js/39.dc1b8498.js"><link rel="prefetch" href="/ifan/assets/js/4.d12742be.js"><link rel="prefetch" href="/ifan/assets/js/40.4564a89c.js"><link rel="prefetch" href="/ifan/assets/js/41.5285d542.js"><link rel="prefetch" href="/ifan/assets/js/42.f9e118fa.js"><link rel="prefetch" href="/ifan/assets/js/43.d704e79d.js"><link rel="prefetch" href="/ifan/assets/js/44.7568a00a.js"><link rel="prefetch" href="/ifan/assets/js/45.4faf2c55.js"><link rel="prefetch" href="/ifan/assets/js/46.d61ccc5a.js"><link rel="prefetch" href="/ifan/assets/js/47.c3584a75.js"><link rel="prefetch" href="/ifan/assets/js/48.b4ab6d26.js"><link rel="prefetch" href="/ifan/assets/js/49.877e309e.js"><link rel="prefetch" href="/ifan/assets/js/5.216cae74.js"><link rel="prefetch" href="/ifan/assets/js/50.025d7120.js"><link rel="prefetch" href="/ifan/assets/js/51.2735f634.js"><link rel="prefetch" href="/ifan/assets/js/52.4048d922.js"><link rel="prefetch" href="/ifan/assets/js/53.97a783b4.js"><link rel="prefetch" href="/ifan/assets/js/54.ade14cad.js"><link rel="prefetch" href="/ifan/assets/js/55.979eb5af.js"><link rel="prefetch" href="/ifan/assets/js/56.ffa2cb08.js"><link rel="prefetch" href="/ifan/assets/js/57.cadd8ade.js"><link rel="prefetch" href="/ifan/assets/js/58.d58d6077.js"><link rel="prefetch" href="/ifan/assets/js/59.f718c761.js"><link rel="prefetch" href="/ifan/assets/js/6.2d0a63f8.js"><link rel="prefetch" href="/ifan/assets/js/60.5b81e822.js"><link rel="prefetch" href="/ifan/assets/js/61.73e80385.js"><link rel="prefetch" href="/ifan/assets/js/62.233b98ba.js"><link rel="prefetch" href="/ifan/assets/js/63.c898aba2.js"><link rel="prefetch" href="/ifan/assets/js/64.7f097fe2.js"><link rel="prefetch" href="/ifan/assets/js/65.5a6ab0d5.js"><link rel="prefetch" href="/ifan/assets/js/66.cbf9bb7d.js"><link rel="prefetch" href="/ifan/assets/js/67.e7d02c5b.js"><link rel="prefetch" href="/ifan/assets/js/68.d0ba1965.js"><link rel="prefetch" href="/ifan/assets/js/69.ca07d9a3.js"><link rel="prefetch" href="/ifan/assets/js/7.9b5ec1cb.js"><link rel="prefetch" href="/ifan/assets/js/70.00651578.js"><link rel="prefetch" href="/ifan/assets/js/71.9db4b1b0.js"><link rel="prefetch" href="/ifan/assets/js/72.13eca694.js"><link rel="prefetch" href="/ifan/assets/js/73.699b8c33.js"><link rel="prefetch" href="/ifan/assets/js/74.b4690b7b.js"><link rel="prefetch" href="/ifan/assets/js/75.ff1fc53c.js"><link rel="prefetch" href="/ifan/assets/js/76.e773f564.js"><link rel="prefetch" href="/ifan/assets/js/77.fc3ed259.js"><link rel="prefetch" href="/ifan/assets/js/78.344f4a30.js"><link rel="prefetch" href="/ifan/assets/js/79.ab846fa2.js"><link rel="prefetch" href="/ifan/assets/js/8.3c3e2ed8.js"><link rel="prefetch" href="/ifan/assets/js/80.f330e268.js"><link rel="prefetch" href="/ifan/assets/js/82.b2ced647.js"><link rel="prefetch" href="/ifan/assets/js/83.a1beb4df.js"><link rel="prefetch" href="/ifan/assets/js/84.288ed86d.js"><link rel="prefetch" href="/ifan/assets/js/85.3f750131.js"><link rel="prefetch" href="/ifan/assets/js/86.bb47a6ab.js"><link rel="prefetch" href="/ifan/assets/js/87.a88861dc.js"><link rel="prefetch" href="/ifan/assets/js/88.3de7d398.js"><link rel="prefetch" href="/ifan/assets/js/9.0fc958c2.js">
    <link rel="stylesheet" href="/ifan/assets/css/0.styles.9066d5db.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/ifan/" class="home-link router-link-active"><!----> <span class="site-name">Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/ifan/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="what?" class="dropdown-title"><span class="title">what?</span> <span class="arrow down"></span></button> <button type="button" aria-label="what?" class="mobile-dropdown-title"><span class="title">what?</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/IFANx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/IFANx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/ifan/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="what?" class="dropdown-title"><span class="title">what?</span> <span class="arrow down"></span></button> <button type="button" aria-label="what?" class="mobile-dropdown-title"><span class="title">what?</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/IFANx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/IFANx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JVM</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Maven</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Redis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringBoot</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>计算机网络</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/ifan/Notes/计算机网络/TCP.html" class="active sidebar-link">TCP</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ifan/Notes/计算机网络/TCP.html#可靠数据传输原理" class="sidebar-link">可靠数据传输原理</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/计算机网络/TCP.html#自动重传请求-automatic-repeat-request-arq-协议" class="sidebar-link">自动重传请求(Automatic Repeat reQuest, ARQ)协议</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/计算机网络/TCP.html#回退n步-go・back・n-gbn-和选择重传-selective-repeat-sr" class="sidebar-link">回退N步 (Go・Back・N, GBN)和选择重传(Selective Repeat, SR)</a></li></ul></li><li><a href="/ifan/Notes/计算机网络/UDP.html" class="sidebar-link">UDP</a></li><li><a href="/ifan/Notes/计算机网络/应用层协议.html" class="sidebar-link">应用层协议</a></li><li><a href="/ifan/Notes/计算机网络/HTTP详解.html" class="sidebar-link">HTTP详解</a></li><li><a href="/ifan/Notes/计算机网络/传输层协议.html" class="sidebar-link">传输层协议</a></li><li><a href="/ifan/Notes/计算机网络/RPC.html" class="sidebar-link">RPC</a></li><li><a href="/ifan/Notes/计算机网络/链路层和局域网.html" class="sidebar-link">链路层和局域网</a></li><li><a href="/ifan/Notes/计算机网络/网络层协议-数据平面.html" class="sidebar-link">网络层协议-数据平面</a></li><li><a href="/ifan/Notes/计算机网络/网络层协议-控制平面.html" class="sidebar-link">网络层协议-控制平面</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MySQL</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>操作系统</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Netty</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JUC</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Summary</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java IO</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>基础和原理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Notes</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="tcp"><a href="#tcp" class="header-anchor">#</a> TCP</h1> <h2 id="可靠数据传输原理"><a href="#可靠数据传输原理" class="header-anchor">#</a> 可靠数据传输原理</h2> <p>为上层实体提供的服务抽象是: 数据可以通过一条可靠的信道进行传输。借助于可靠信道，传输数据比特就不会受到损坏 (由0变为1,或者相反)或丢失，而且所有数据都是按照其发送顺序进行交付。</p> <p>实现这种服务抽象是可靠数据传输协议(reliable data transfer protocol)的责任。由于 可靠数据传输协议的下层协议也许是不可靠的，因此这是一项困难的任务。例如，TCP是 在不可靠的(IP)端到端网络层之上实现的可靠数据传输协议。</p> <h2 id="自动重传请求-automatic-repeat-request-arq-协议"><a href="#自动重传请求-automatic-repeat-request-arq-协议" class="header-anchor">#</a> 自动重传请求(Automatic Repeat reQuest, ARQ)协议</h2> <p>ARQ协议中还需要另外三种协议功能来处理存在比特差错的情况:</p> <p><strong>差错检测。首先，需要一种机制以使接收方检测到何时出现了比特差错。</strong></p> <p><strong>接收方反馈。因为发送方和接收方通常在不同端系统上执行，可能相隔数千英里, 发送方要了解接收方情况(此时为分组是否被正确接收)的唯一途径就是让接收 方提供明确的反馈信息给发送方。</strong></p> <p><strong>重传。接收方收到有差错的分组时，发送方将重传该分组文。</strong></p> <h2 id="回退n步-go・back・n-gbn-和选择重传-selective-repeat-sr"><a href="#回退n步-go・back・n-gbn-和选择重传-selective-repeat-sr" class="header-anchor">#</a> <strong>回退N步 (Go・Back・N, GBN)和选择重传(Selective Repeat, SR)</strong></h2> <p>在回退N步 (GBN)协议中，允许发送方发送多个分组(当有多个分组可用时)而 不需等待确认，但它也受限于在流水线中未确认的分组数不能超过某个最大允许数/V。</p> <p>图3・19显示了发送方看到的GBN协议的序号范围。如果我们将基序号(base)定义为最早未确认分组的序号，将下一个序号(nextseqnum)定义为最小的未使用序号(即下 一个待发分组的序号)，则可将序号范围分割成4 段。在 [0, base - 1 ]段内的序号对应 于已经发送并被确认的分组。 [base, nextseqnum - 1 ]段内对应已经发送但未被确认的分 组。[nextseqnum, base +/V - 1 ]段内的序号能用于那些要被立即发送的分组，如果有数 据来自上层的话。 【后，大于或等于base + N的序号是不能使用的，直到当前流水线中未被确认的分组(特别是序号为base的分组)已得到确认为止。</p> <p><img src="http://8.130.25.175:8080/img/image-20230513154957579.png" alt="image-20230513154957579"></p> <p>随着协议的运行，该窗口的序号空间向前滑动，N常被称为窗口长度，GBN协议也常被称为<strong>滑动窗口协议</strong>。</p> <p>在实践中，一个分组的序号承载在分组首部的一个固定长度的字段中。如果分组序号 字段的比特数是仁 则该序号范围是[0, 在一个有限的序号范围内，所有涉及序</p> <p>号的运算必须使用模2&quot;运算。</p> <p>GBN协议潜在地允许发送方用多个分组“填充流水线”，因此避免了停 等协议中所提到的信道利用率问题。GBN本身也有一些情况存在着性能问题。尤其 是当窗口长度和带宽时延积都很大时，在流水线中会有很多分组更是如此。单个分组的差错就能够引起GBN重传大量分组，许多分组根本没有必要重传。随着信道差错率的增加, 流水线可能会被这些不必要重传的分组所充斥。</p> <p><strong>选择重传(SR)协议通过让发送方仅重传那些它怀疑在接收方出错(即 丢失或受损)的分组而避免了不必要的重传。</strong></p> <p>这种个别的、按需的重传要求接收方逐个地 确认正确接收的分组。再次用窗口长度7V来限制流水线中未完成、未被确认的分组数。然而，与GBN不同的是，发送方已经收到了对窗口中某些分组的ACK。图3・23显示了 SR 发送方看到的序号空间。图3-24详细描述了 SR发送方所采取的动作。</p> <p><img src="http://8.130.25.175:8080/img/image-20230513160145440.png" alt="image-20230513160145440"></p> <p>SR接收方将确认一个正确接收的分组而不管其是否按序。失序的分组将被缓存直到所有丢失分组(即序号更小的分组)皆被收到为止，这时才可以将一批分组按序交付给上 层。</p> <p><em><em>选择重传协议中，窗口长度必须小于等于序号空间大小的一半</em>，原因在于区分是新传输的分组还是崇川的分组</em>*</p> <p><img src="http://8.130.25.175:8080/img/image-20230513161238706.png" alt="image-20230513161238706"></p> <p><strong>TCP报文字段</strong></p> <p>TCP头部20字节，UDP头部8字节</p> <p><img src="http://8.130.25.175:8080/img/image-20230513163133652.png" alt="image-20230513163133652"></p> <p>序号和确认号</p> <p>往返时间的估计与超时：它采用超时/重传机制来处理报文段的丢失问 题。尽管这在概念上简单，但是当在如TCP这样的实际协议中实现超时/重传机制时还是会 产生许多微妙的问题。也许最明显的一个问题就是超时间隔长度的设置。显然，超时间隔必 须大于该连接的往返时间(RTT), 即从一个报文段发出到它被确认的时间。否则会造成不必要的重传。但是这个时间间隔到底应该是多大呢?刚开始时应如何估计往返时间呢?是否 应该为所有未确认的报文段各设一个定时器</p> <p>报文段的样本RTT (表示为SampleRTT)就 是从某报文段被发出(即交给IP) 到对该报文段的确认被收到之间的时间量。大多数TCP的实现仅在某个时刻做一次SampleRTT测量，而不是为每个发送的报文段测量一个SampleRTTo 这就是说，在任意时刻，仅为一个已发送的但目前尚未被确认的报文段估计SampleRTT,从而产生一个接近每个RTT的新SampleRTT值。</p> <p>​																			EstimatedRTT = (1 - a ) • EstimatedRTT + a • SampleRTT</p> <p>EstimatedRTT的新值是由以前的Esti- matedRTT值与SampleRTT新值加权组合而成的。</p> <p>设置和管理重传超时间隔</p> <p>假设已经给岀了 EstimatedRTT值和DevRTT值，那么TCP超时间隔应该用什么值呢? 很明显，超时间隔应该大于等于EstimatedR^IT,否则，将造成不必要的重传。但是超时间 隔也不应该比EstimatedRTT大太多，否则当报文段丢失时，TCP不能很快地重传该报文段，导致数据传输时延大。因此要求将超时间隔设为EstimatedRTT加上一定余量</p> <p><strong>TCP连接建立的三次握手</strong></p> <p><img src="http://8.130.25.175:8080/img/image-20230513165604804.png" alt="image-20230513165604804"></p> <p><strong>TCP连接断开</strong></p> <p><img src="http://8.130.25.175:8080/img/image-20230513165713387.png" alt="image-20230513165713387"></p> <p><strong>SYN洪泛攻击</strong></p> <p>我们在TCP三次握手的讨论中已经看到，服务器为了响应一个收到的SYN,分配并 初始化连接变量和缓存。然后服务器发送一个SYNACK进行响应，并等待来自客户的 ACK报文段。如果某客户不发送ACK来完成该三次握手的第三步，最终(通常在一分多钟之后)服务器将终止该半开连接并回收资源。</p> <p>这种TCP连接管理协议为经典的DoS攻击即SYN洪泛攻击(SYN flood attack)提供了环境。在这种攻击中，攻击者发送大量的TCP SYN报文段，而不完成第三次握手 的步骤。随着这种SYN报文段纷至沓来，服务器不断为这些半开连接分配资源(但从未使用)，导致服务器的连接资源被消耗殆尽。这种SYN洪泛攻击是被记载的众多DoS攻 击中的第一种[CERTSYN 1996]。</p> <p>应对方式SYN cookie：</p> <ul><li>当服务器接收到一个SYN报文段时，它并不知道该报文段是来自一个合法的用户，还是一个SYN洪泛攻击的一部分。因此服务器不会为该报文段生成一个半 开连接。相反，服务器生成一个初始TCP序列号，该序列号是SYN报文段的源和目的IP地址与端口号以及仅有该服务器知道的秘密数的一个复杂函数(散列 函数)。这种精心制作的初始序列号被称为“cookie”。服务器则发送具有这种 特殊初始序列号的SYNACK分组。重要的是，服务器并不记忆该cookie或任何对应于SYN的其他状态信息</li> <li>如果客户是合法的，则它将返回一个ACK报文段。当服务器收到该ACK,需要验证该ACK是与前面发送的某些SYN相对应的。如果服务器没有维护有关SYN 报文段的记忆，这是怎样完成的呢?正如你可能猜测的那样，它是借助于cookie来做到的。前面讲过对于一个合法的ACK,在确认字段中的值等于在 SYNACK字段(此时为cookie值)中的值加1 (参见图3-39)o服务器则将使用在SYNACK报文段中的源和目的地IP地址与端口号(它们与初始的SYN中的 相同)以及秘密数运行相同的散列函数。如果该函数的结果加1与在客户的 SYNACK中的确认(cookie)值相同的话，服务器认为该ACK对应于较早的SYN报文段，因此它是合法的。服务器则生成一个具有套接字的全开的连接。</li> <li>在另一方面，如果客户没有返回一个ACK报文段，则初始的SYN并没有对服务器产生危害，因为服务器没有为它分配任何资源。</li></ul> <p><strong>拥塞控制方法</strong>：</p> <ul><li><p>端到端拥寒控制。在端到端拥塞控制方法中，网络层没有为运输层拥塞控制提供显式支持。即使网络中存在拥塞，端系统也必须通过对网络行为的观察(如分组 丢失与时延)来推断之。TCP报文段的丢失(通过超时或3 次冗余确认而得知)被认为是网络拥塞的一个迹象，TCP 会相应地减小其窗口长度</p></li> <li><p>网络辅助的拥塞控制。在网络辅助的拥塞控制中，路由器向发送方提供关于网络中拥塞状态的显式反馈信息。这种反馈可以简单地用一个比特来指示链路中的拥塞情况。</p> <p>TCP使用的为端到端的拥塞控制</p></li></ul> <p>第一，一个TCP发送方如何限制它向其连接发送流量的速率呢？</p> <p>第二，一个TCP发送方如何感知从它到目的地之间的 路径上存在拥塞呢?</p> <p>第三，当发送方感知到端到端的拥塞时，采用何种算法来改变其发送速率呢?</p> <p><strong>TCP拥塞控制算法(TCP congestion control algorithm）</strong></p> <p>该算法包括3个主要部分:1慢启动;2拥塞避免; 3快速恢复。慢启动和拥塞避免是TCP的强制部分，两者的差异在于对收到的ACK做出反应时增加cwnd长度的方式。</p> <p><img src="http://8.130.25.175:8080/img/image-20230513171837631.png" alt="image-20230513171837631"></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/ifan/Notes/数据结构/红黑树.html" class="prev">
        红黑树
      </a></span> <span class="next"><a href="/ifan/Notes/计算机网络/UDP.html">
        UDP
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/ifan/assets/js/app.5185ce44.js" defer></script><script src="/ifan/assets/js/2.733019b2.js" defer></script><script src="/ifan/assets/js/81.b9c602ba.js" defer></script>
  </body>
</html>
