<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring基础 - Spring核心之面向切面编程(AOP) | Notes</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="办法总比问题多">
    
    <link rel="preload" href="/ifan/assets/css/0.styles.9066d5db.css" as="style"><link rel="preload" href="/ifan/assets/js/app.c758c43a.js" as="script"><link rel="preload" href="/ifan/assets/js/2.733019b2.js" as="script"><link rel="preload" href="/ifan/assets/js/20.f3544a96.js" as="script"><link rel="prefetch" href="/ifan/assets/js/10.6ad50f59.js"><link rel="prefetch" href="/ifan/assets/js/11.4cd18427.js"><link rel="prefetch" href="/ifan/assets/js/12.53231ba7.js"><link rel="prefetch" href="/ifan/assets/js/13.c605ba48.js"><link rel="prefetch" href="/ifan/assets/js/14.51fb682b.js"><link rel="prefetch" href="/ifan/assets/js/15.2d4587f3.js"><link rel="prefetch" href="/ifan/assets/js/16.22f92a43.js"><link rel="prefetch" href="/ifan/assets/js/17.16e8f69c.js"><link rel="prefetch" href="/ifan/assets/js/18.795b9b93.js"><link rel="prefetch" href="/ifan/assets/js/19.0ed9e4cd.js"><link rel="prefetch" href="/ifan/assets/js/21.ca8cc888.js"><link rel="prefetch" href="/ifan/assets/js/22.39d4678c.js"><link rel="prefetch" href="/ifan/assets/js/23.adf247d2.js"><link rel="prefetch" href="/ifan/assets/js/24.1bc4f751.js"><link rel="prefetch" href="/ifan/assets/js/25.50cabe6f.js"><link rel="prefetch" href="/ifan/assets/js/26.58e97a39.js"><link rel="prefetch" href="/ifan/assets/js/27.a66b5e1c.js"><link rel="prefetch" href="/ifan/assets/js/28.cc802bc5.js"><link rel="prefetch" href="/ifan/assets/js/29.0c62e816.js"><link rel="prefetch" href="/ifan/assets/js/3.5c0ad6fc.js"><link rel="prefetch" href="/ifan/assets/js/30.af66b59c.js"><link rel="prefetch" href="/ifan/assets/js/31.85bde19d.js"><link rel="prefetch" href="/ifan/assets/js/32.f1198520.js"><link rel="prefetch" href="/ifan/assets/js/33.379d76f0.js"><link rel="prefetch" href="/ifan/assets/js/34.833fcec5.js"><link rel="prefetch" href="/ifan/assets/js/35.1cae4197.js"><link rel="prefetch" href="/ifan/assets/js/36.e1994734.js"><link rel="prefetch" href="/ifan/assets/js/37.acbf01ba.js"><link rel="prefetch" href="/ifan/assets/js/38.fb6b83ad.js"><link rel="prefetch" href="/ifan/assets/js/39.8aef9d9f.js"><link rel="prefetch" href="/ifan/assets/js/4.d12742be.js"><link rel="prefetch" href="/ifan/assets/js/40.627aec40.js"><link rel="prefetch" href="/ifan/assets/js/5.216cae74.js"><link rel="prefetch" href="/ifan/assets/js/6.2d0a63f8.js"><link rel="prefetch" href="/ifan/assets/js/7.cb0ad016.js"><link rel="prefetch" href="/ifan/assets/js/8.24171bee.js"><link rel="prefetch" href="/ifan/assets/js/9.51ae0b8b.js">
    <link rel="stylesheet" href="/ifan/assets/css/0.styles.9066d5db.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/ifan/" class="home-link router-link-active"><!----> <span class="site-name">Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/ifan/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="what?" class="dropdown-title"><span class="title">what?</span> <span class="arrow down"></span></button> <button type="button" aria-label="what?" class="mobile-dropdown-title"><span class="title">what?</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/IFANx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/IFANx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/ifan/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="what?" class="dropdown-title"><span class="title">what?</span> <span class="arrow down"></span></button> <button type="button" aria-label="what?" class="mobile-dropdown-title"><span class="title">what?</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/IFANx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/IFANx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JVM</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>操作系统</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Netty</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JUC</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java IO</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Spring</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/ifan/Notes/JVM/Spring/Spring框架知识体系.html" class="sidebar-link">Spring框架知识体系</a></li><li><a href="/ifan/Notes/JVM/Spring/Spring进阶-IOC体系结构设计.html" class="sidebar-link">Spring进阶-IOC体系结构设计</a></li><li><a href="/ifan/Notes/JVM/Spring/Spring进阶-Spring AOP实现原理之AOP切面实现.html" class="sidebar-link">Spring进阶-Spring AOP实现原理之AOP切面实现</a></li><li><a href="/ifan/Notes/JVM/Spring/Spring基础 - SpringMVC请求流程和案例.html" class="sidebar-link">Spring基础 - SpringMVC请求流程和案例</a></li><li><a href="/ifan/Notes/JVM/Spring/Spring基础 - Spring核心之控制反转(IOC).html" class="sidebar-link">Spring基础 - Spring核心之控制反转(IOC)</a></li><li><a href="/ifan/Notes/JVM/Spring/Spring基础 - Spring核心之面向切面编程(AOP).html" class="active sidebar-link">Spring基础 - Spring核心之面向切面编程(AOP)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ifan/Notes/JVM/Spring/Spring基础 - Spring核心之面向切面编程(AOP).html#如何理解aop" class="sidebar-link">如何理解AOP</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ifan/Notes/JVM/Spring/Spring基础 - Spring核心之面向切面编程(AOP).html#aop是什么" class="sidebar-link">[#](https://pdai.tech/md/spring/spring-x-framework-aop.html#aop是什么)AOP是什么</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/JVM/Spring/Spring基础 - Spring核心之面向切面编程(AOP).html#aop术语" class="sidebar-link">AOP术语</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/JVM/Spring/Spring基础 - Spring核心之面向切面编程(AOP).html#spring-aop和aspectj是什么关系" class="sidebar-link">Spring AOP和AspectJ是什么关系</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/JVM/Spring/Spring基础 - Spring核心之面向切面编程(AOP).html#aspectj注解方式" class="sidebar-link">AspectJ注解方式</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/JVM/Spring/Spring基础 - Spring核心之面向切面编程(AOP).html#切入点-pointcut-的申明规则" class="sidebar-link">切入点（pointcut）的申明规则?</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/JVM/Spring/Spring基础 - Spring核心之面向切面编程(AOP).html#spring-aop-和-aspectj-之间的关键区别" class="sidebar-link">Spring AOP 和 AspectJ 之间的关键区别？</a></li><li class="sidebar-sub-header"><a href="/ifan/Notes/JVM/Spring/Spring基础 - Spring核心之面向切面编程(AOP).html#spring-aop还是完全用aspectj" class="sidebar-link">Spring AOP还是完全用AspectJ？</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Notes</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="content__default"><h1 id="spring基础-spring核心之面向切面编程-aop"><a href="#spring基础-spring核心之面向切面编程-aop" class="header-anchor">#</a> Spring基础 - Spring核心之面向切面编程(AOP)</h1> <p>https://pdai.tech/md/spring/spring-x-framework-aop.html</p> <p>Spring 框架通过定义切面, 通过拦截切点实现了不同业务模块的解耦，这个就叫<strong>面向切面编程 - Aspect Oriented Programming (AOP)</strong></p> <p>为什么@Aspect注解使用的是aspectj的jar包呢？这就引出了<strong>Aspect4J和Spring AOP的历史渊源</strong>，只有理解了Aspect4J和Spring的渊源才能理解有些注解上的兼容设计</p> <p>如何支持<strong>更多拦截方式</strong>来实现解耦， 以满足更多场景需求呢？ 这就是@Around, @Pointcut... 等的设计</p> <p>那么Spring框架又是如何实现AOP的呢？ 这就引入<strong>代理技术，分静态代理和动态代理</strong>，动态代理又包含JDK代理和CGLIB代理等</p> <hr> <h2 id="如何理解aop"><a href="#如何理解aop" class="header-anchor">#</a> 如何理解AOP</h2> <blockquote><p>AOP的本质也是为了解耦，它是一种设计思想； 在理解时也应该简化理解。</p></blockquote> <h3 id="aop是什么"><a href="#aop是什么" class="header-anchor">#</a> <a href="https://pdai.tech/md/spring/spring-x-framework-aop.html#aop%E6%98%AF%E4%BB%80%E4%B9%88" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>AOP是什么</h3> <blockquote><p>AOP为Aspect Oriented Programming的缩写，意为：面向切面编程</p></blockquote> <p>AOP最早是AOP联盟的组织提出的,指定的一套规范,spring将AOP的思想引入框架之中,通过<strong>预编译方式</strong>和<strong>运行期间动态代理</strong>实现程序的统一维护的一种技术</p> <p>我们将记录日志功能解耦为日志切面，它的目标是解耦。进而引出AOP的理念：就是将分散在各个业务逻辑代码中相同的代码通过<strong>横向切割</strong>的方式抽取到一个独立的模块中！</p> <p><img src="http://8.130.25.175:8080/img/spring-framework-aop-4.png" alt="spring-framework-aop-4"></p> <p>OOP面向对象编程，针对业务处理过程的实体及其属性和行为进行抽象封装，以获得更加清晰高效的逻辑单元划分。而AOP则是针对业务处理过程中的切面进行提取，它所面对的是处理过程的某个步骤或阶段，以获得逻辑过程的中各部分之间低耦合的隔离效果。这两种设计思想在目标上有着本质的差异。</p> <hr> <h3 id="aop术语"><a href="#aop术语" class="header-anchor">#</a> AOP术语</h3> <blockquote><p>首先让我们从一些重要的AOP概念和术语开始。<strong>这些术语不是Spring特有的</strong>。</p></blockquote> <ul><li><strong>连接点（Jointpoint）</strong>：表示需要在程序中插入横切关注点的扩展点，<strong>连接点可能是类初始化、方法执行、方法调用、字段调用或处理异常等等</strong>，Spring只支持方法执行连接点，在AOP中表示为<strong>在哪里干</strong>；</li> <li><strong>切入点（Pointcut）</strong>： 选择一组相关连接点的模式，即可以认为连接点的集合，Spring支持perl5正则表达式和AspectJ切入点模式，Spring默认使用AspectJ语法，在AOP中表示为<strong>在哪里干的集合</strong>；</li> <li><strong>通知（Advice）</strong>：在连接点上执行的行为，通知提供了在AOP中需要在切入点所选择的连接点处进行扩展现有行为的手段；包括前置通知（before advice）、后置通知(after advice)、环绕通知（around advice），在Spring中通过代理模式实现AOP，并通过拦截器模式以环绕连接点的拦截器链织入通知；在AOP中表示为<strong>干什么</strong>；</li> <li><strong>方面/切面（Aspect）</strong>：横切关注点的模块化，比如上边提到的日志组件。可以认为是通知、引入和切入点的组合；在Spring中可以使用Schema和@AspectJ方式进行组织实现；在AOP中表示为<strong>在哪干和干什么集合</strong>；</li> <li><strong>引入（inter-type declaration）</strong>：也称为内部类型声明，为已有的类添加额外新的字段或方法，Spring允许引入新的接口（必须对应一个实现）到所有被代理对象（目标对象）, 在AOP中表示为<strong>干什么（引入什么）</strong>；</li> <li><strong>目标对象（Target Object）</strong>：需要被织入横切关注点的对象，即该对象是切入点选择的对象，需要被通知的对象，从而也可称为被通知对象；由于Spring AOP 通过代理模式实现，从而这个对象永远是被代理对象，在AOP中表示为<strong>对谁干</strong>；</li> <li><strong>织入（Weaving）</strong>：把切面连接到其它的应用程序类型或者对象上，并创建一个被通知的对象。这些可以在编译时（例如使用AspectJ编译器），类加载时和运行时完成。Spring和其他纯Java AOP框架一样，在运行时完成织入。在AOP中表示为<strong>怎么实现的</strong>；</li> <li><strong>AOP代理（AOP Proxy）</strong>：AOP框架使用代理模式创建的对象，从而实现在连接点处插入通知（即应用切面），就是通过代理来对目标对象应用切面。在Spring中，AOP代理可以用JDK动态代理或CGLIB代理实现，而通过拦截器模型应用切面。在AOP中表示为<strong>怎么实现的一种典型方式</strong>；</li></ul> <blockquote><p><strong>通知类型</strong>：</p></blockquote> <ul><li><strong>前置通知（Before advice）</strong>：在某连接点之前执行的通知，但这个通知不能阻止连接点之前的执行流程（除非它抛出一个异常）。</li> <li><strong>后置通知（After returning advice）</strong>：在某连接点正常完成后执行的通知：例如，一个方法没有抛出任何异常，正常返回。</li> <li><strong>异常通知（After throwing advice）</strong>：在方法抛出异常退出时执行的通知。</li> <li><strong>最终通知（After (finally) advice）</strong>：当某连接点退出的时候执行的通知（不论是正常返回还是异常退出）。</li> <li><strong>环绕通知（Around Advice）</strong>：包围一个连接点的通知，如方法调用。这是最强大的一种通知类型。环绕通知可以在方法调用前后完成自定义的行为。它也会选择是否继续执行连接点或直接返回它自己的返回值或抛出异常来结束执行。</li></ul> <p>环绕通知是最常用的通知类型。和AspectJ一样，Spring提供所有类型的通知，我们推荐你使用尽可能简单的通知类型来实现需要的功能。例如，如果你只是需要一个方法的返回值来更新缓存，最好使用后置通知而不是环绕通知，尽管环绕通知也能完成同样的事情。用最合适的通知类型可以使得编程模型变得简单，并且能够避免很多潜在的错误。比如，你不需要在JoinPoint上调用用于环绕通知的proceed()方法，就不会有调用的问题。</p> <blockquote></blockquote> <hr> <h3 id="spring-aop和aspectj是什么关系"><a href="#spring-aop和aspectj是什么关系" class="header-anchor">#</a> Spring AOP和AspectJ是什么关系</h3> <ul><li><strong>首先AspectJ是什么</strong>？</li></ul> <p>AspectJ是一个java实现的AOP框架，它能够对java代码进行AOP编译（一般在编译期进行），让java代码具有AspectJ的AOP功能（当然需要特殊的编译器）</p> <p>可以这样说AspectJ是目前实现AOP框架中最成熟，功能最丰富的语言，更幸运的是，AspectJ与java程序完全兼容，几乎是无缝关联，因此对于有java编程基础的工程师，上手和使用都非常容易。</p> <ul><li><strong>其次，为什么需要理清楚Spring AOP和AspectJ的关系</strong>？</li></ul> <p>我们看下@Aspect以及增强的几个注解，为什么不是Spring包，而是来源于aspectJ呢？</p> <p><img src="http://8.130.25.175:8080/img/spring-framework-aop-5.png" alt="spring-framework-aop-4"></p> <ul><li><strong>Spring AOP和AspectJ是什么关系</strong>？</li></ul> <ol><li>AspectJ是更强的AOP框架，是实际意义的<strong>AOP标准</strong>；</li> <li>Spring为何不写类似AspectJ的框架？ Spring AOP使用纯Java实现, 它不需要专门的编译过程, 它一个<strong>重要的原则就是无侵入性（non-invasiveness）</strong>; Spring 小组完全有能力写类似的框架，只是Spring AOP从来没有打算通过提供一种全面的AOP解决方案来与AspectJ竞争。Spring的开发小组相信无论是基于代理（proxy-based）的框架如Spring AOP或者是成熟的框架如AspectJ都是很有价值的，他们之间应该是<strong>互补而不是竞争的关系</strong>。</li> <li>Spring小组喜欢@AspectJ注解风格更胜于Spring XML配置； 所以<strong>在Spring 2.0使用了和AspectJ 5一样的注解，并使用AspectJ来做切入点解析和匹配</strong>。<strong>但是，AOP在运行时仍旧是纯的Spring AOP，并不依赖于AspectJ的编译器或者织入器（weaver）</strong>。</li> <li>Spring 2.5对AspectJ的支持：在一些环境下，增加了对AspectJ的装载时编织支持，同时提供了一个新的bean切入点。</li></ol> <ul><li><strong>更多关于AspectJ</strong>？</li></ul> <p><strong>了解AspectJ应用到java代码的过程（这个过程称为织入），对于织入这个概念，可以简单理解为aspect(切面)应用到目标函数(类)的过程。</strong></p> <p>对于这个过程，一般分为<strong>动态织入</strong>和<strong>静态织入</strong>：</p> <ol><li>动态织入的方式是在运行时动态将要增强的代码织入到目标类中，这样往往是通过动态代理技术完成的，如Java JDK的动态代理(Proxy，底层通过反射实现)或者CGLIB的动态代理(底层通过继承实现)，Spring AOP采用的就是基于运行时增强的代理技术</li> <li>ApectJ采用的就是静态织入的方式。ApectJ主要采用的是编译期织入，在这个期间使用AspectJ的acj编译器(类似javac)把aspect类编译成class字节码后，在java目标类编译时织入，即先编译aspect类再编译目标类。</li></ol> <p><img src="http://8.130.25.175:8080/img/spring-framework-aop-6.png" alt="spring-framework-aop-4"></p> <hr> <h3 id="aspectj注解方式"><a href="#aspectj注解方式" class="header-anchor">#</a> AspectJ注解方式</h3> <p>基于XML的声明式AspectJ存在一些不足，需要在Spring配置文件配置大量的代码信息，为了解决这个问题，Spring 使用了@AspectJ框架为AOP的实现提供了一套注解。</p> <table><thead><tr><th>注解名称</th> <th>解释</th></tr></thead> <tbody><tr><td>@Aspect</td> <td>用来定义一个切面。</td></tr> <tr><td>@pointcut</td> <td>用于定义切入点表达式。在使用时还需要定义一个包含名字和任意参数的方法签名来表示切入点名称，这个方法签名就是一个返回值为void，且方法体为空的普通方法。</td></tr> <tr><td>@Before</td> <td>用于定义前置通知，相当于BeforeAdvice。在使用时，通常需要指定一个value属性值，该属性值用于指定一个切入点表达式(可以是已有的切入点，也可以直接定义切入点表达式)。</td></tr> <tr><td>@AfterReturning</td> <td>用于定义后置通知，相当于AfterReturningAdvice。在使用时可以指定pointcut / value和returning属性，其中pointcut / value这两个属性的作用一样，都用于指定切入点表达式。</td></tr> <tr><td>@Around</td> <td>用于定义环绕通知，相当于MethodInterceptor。在使用时需要指定一个value属性，该属性用于指定该通知被植入的切入点。</td></tr> <tr><td>@After-Throwing</td> <td>用于定义异常通知来处理程序中未处理的异常，相当于ThrowAdvice。在使用时可指定pointcut / value和throwing属性。其中pointcut/value用于指定切入点表达式，而throwing属性值用于指定-一个形参名来表示Advice方法中可定义与此同名的形参，该形参可用于访问目标方法抛出的异常。</td></tr> <tr><td>@After</td> <td>用于定义最终final 通知，不管是否异常，该通知都会执行。使用时需要指定一个value属性，该属性用于指定该通知被植入的切入点。</td></tr> <tr><td>@DeclareParents</td> <td>用于定义引介通知，相当于IntroductionInterceptor (不要求掌握)。</td></tr></tbody></table> <hr> <blockquote><p>Spring AOP的实现方式是动态织入，动态织入的方式是在运行时动态将要增强的代码织入到目标类中，这样往往是通过动态代理技术完成的；<strong>如Java JDK的动态代理(Proxy，底层通过反射实现)或者CGLIB的动态代理(底层通过继承实现)</strong>，Spring AOP采用的就是基于运行时增强的代理技术。所以我们看下如下的两个例子(<a href="https://github.com/realpdai/tech-pdai-spring-demos" target="_blank" rel="noopener noreferrer">例子代码在新窗口打开<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中05模块）：</p> <ul><li>基于JDK代理例子</li> <li>基于Cglib代理例子</li></ul></blockquote> <h4 id="接口使用jdk代理"><a href="#接口使用jdk代理" class="header-anchor">#</a> 接口使用JDK代理</h4> <ul><li>定义接口</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * Jdk Proxy Service.
 *
 * @author pdai
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IJdkProxyService</span> <span class="token punctuation">{</span>

    <span class="token keyword">void</span> <span class="token function">doMethod1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> <span class="token function">doMethod2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> <span class="token function">doMethod3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>实现类</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * @author pdai
 */</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdkProxyDemoServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">IJdkProxyService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doMethod1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;JdkProxyServiceImpl.doMethod1()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">doMethod2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;JdkProxyServiceImpl.doMethod2()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;hello world&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">doMethod3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;JdkProxyServiceImpl.doMethod3()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string">&quot;some exception&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><strong>定义切面</strong></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">tech<span class="token punctuation">.</span>pdai<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>aspect</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span><span class="token class-name">ProceedingJoinPoint</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">After</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">AfterReturning</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">AfterThrowing</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Around</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Aspect</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Before</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Pointcut</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">EnableAspectJAutoProxy</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author pdai
 */</span>
<span class="token annotation punctuation">@EnableAspectJAutoProxy</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogAspect</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * define point cut.
     */</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(* tech.pdai.springframework.service.*.*(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pointCutMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 环绕通知.
     *
     * @param pjp pjp
     * @return obj
     * @throws Throwable exception
     */</span>
    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">&quot;pointCutMethod()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">doAround</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> pjp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----------------------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;环绕通知: 进入方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> o <span class="token operator">=</span> pjp<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;环绕通知: 退出方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> o<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 前置通知.
     */</span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;pointCutMethod()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doBefore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;前置通知&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 后置通知.
     *
     * @param result return val
     */</span>
    <span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span>pointcut <span class="token operator">=</span> <span class="token string">&quot;pointCutMethod()&quot;</span><span class="token punctuation">,</span> returning <span class="token operator">=</span> <span class="token string">&quot;result&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doAfterReturning</span><span class="token punctuation">(</span><span class="token class-name">String</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;后置通知, 返回值: &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 异常通知.
     *
     * @param e exception
     */</span>
    <span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span>pointcut <span class="token operator">=</span> <span class="token string">&quot;pointCutMethod()&quot;</span><span class="token punctuation">,</span> throwing <span class="token operator">=</span> <span class="token string">&quot;e&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doAfterThrowing</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;异常通知, 异常: &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 最终通知.
     */</span>
    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">&quot;pointCutMethod()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doAfter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;最终通知&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><ul><li><strong>输出</strong></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
环绕通知<span class="token operator">:</span> 进入方法
前置通知
<span class="token class-name">JdkProxyServiceImpl</span><span class="token punctuation">.</span><span class="token function">doMethod1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
最终通知
环绕通知<span class="token operator">:</span> 退出方法
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
环绕通知<span class="token operator">:</span> 进入方法
前置通知
<span class="token class-name">JdkProxyServiceImpl</span><span class="token punctuation">.</span><span class="token function">doMethod2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
后置通知<span class="token punctuation">,</span> 返回值<span class="token operator">:</span> hello world
最终通知
环绕通知<span class="token operator">:</span> 退出方法
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
环绕通知<span class="token operator">:</span> 进入方法
前置通知
<span class="token class-name">JdkProxyServiceImpl</span><span class="token punctuation">.</span><span class="token function">doMethod3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
异常通知<span class="token punctuation">,</span> 异常<span class="token operator">:</span> some exception
最终通知
</code></pre></div><h3 id="切入点-pointcut-的申明规则"><a href="#切入点-pointcut-的申明规则" class="header-anchor">#</a> 切入点（pointcut）的申明规则?</h3> <p>Spring AOP 用户可能会经常使用 execution切入点指示符。执行表达式的格式如下：</p> <div class="language-java extra-class"><pre class="language-java"><code>execution（modifiers<span class="token operator">-</span>pattern<span class="token operator">?</span> ret<span class="token operator">-</span>type<span class="token operator">-</span>pattern declaring<span class="token operator">-</span>type<span class="token operator">-</span>pattern<span class="token operator">?</span> name<span class="token operator">-</span>pattern（param<span class="token operator">-</span>pattern） <span class="token keyword">throws</span><span class="token operator">-</span>pattern<span class="token operator">?</span>）
</code></pre></div><ul><li>ret-type-pattern 返回类型模式, name-pattern名字模式和param-pattern参数模式是必选的， 其它部分都是可选的。返回类型模式决定了方法的返回类型必须依次匹配一个连接点。 你会使用的最频繁的返回类型模式是<code>*</code>，<strong>它代表了匹配任意的返回类型</strong>。</li> <li>declaring-type-pattern, 一个全限定的类型名将只会匹配返回给定类型的方法。</li> <li>name-pattern 名字模式匹配的是方法名。 你可以使用<code>*</code>通配符作为所有或者部分命名模式。</li> <li>param-pattern 参数模式稍微有点复杂：()匹配了一个不接受任何参数的方法， 而(..)匹配了一个接受任意数量参数的方法（零或者更多）。 模式(<em>)匹配了一个接受一个任何类型的参数的方法。 模式(</em>,String)匹配了一个接受两个参数的方法，第一个可以是任意类型， 第二个则必须是String类型。</li></ul> <p>对应到我们上面的例子：</p> <p><img src="/images/spring/springframework/spring-framework-aop-7.png" alt="img"></p> <p>下面给出一些通用切入点表达式的例子。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 任意公共方法的执行：</span>
execution（<span class="token keyword">public</span> <span class="token operator">*</span> <span class="token operator">*</span>（<span class="token punctuation">.</span><span class="token punctuation">.</span>））

<span class="token comment">// 任何一个名字以“set”开始的方法的执行：</span>
execution（<span class="token operator">*</span> set<span class="token operator">*</span>（<span class="token punctuation">.</span><span class="token punctuation">.</span>））

<span class="token comment">// AccountService接口定义的任意方法的执行：</span>
execution（<span class="token operator">*</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>xyz<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span>AccountService</span><span class="token punctuation">.</span>*（<span class="token punctuation">.</span><span class="token punctuation">.</span>））

<span class="token comment">// 在service包中定义的任意方法的执行：</span>
execution（<span class="token operator">*</span> com<span class="token punctuation">.</span>xyz<span class="token punctuation">.</span>service<span class="token punctuation">.</span>*<span class="token punctuation">.</span>*（<span class="token punctuation">.</span><span class="token punctuation">.</span>））

<span class="token comment">// 在service包或其子包中定义的任意方法的执行：</span>
execution（<span class="token operator">*</span> com<span class="token punctuation">.</span>xyz<span class="token punctuation">.</span>service<span class="token punctuation">.</span><span class="token punctuation">.</span>*<span class="token punctuation">.</span>*（<span class="token punctuation">.</span><span class="token punctuation">.</span>））

<span class="token comment">// 在service包中的任意连接点（在Spring AOP中只是方法执行）：</span>
within（com<span class="token punctuation">.</span>xyz<span class="token punctuation">.</span>service<span class="token punctuation">.</span>*）

<span class="token comment">// 在service包或其子包中的任意连接点（在Spring AOP中只是方法执行）：</span>
within（com<span class="token punctuation">.</span>xyz<span class="token punctuation">.</span>service<span class="token punctuation">.</span><span class="token punctuation">.</span>*）

<span class="token comment">// 实现了AccountService接口的代理对象的任意连接点 （在Spring AOP中只是方法执行）：</span>
<span class="token keyword">this</span>（<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>xyz<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span>AccountService</span>）<span class="token comment">// 'this'在绑定表单中更加常用</span>

<span class="token comment">// 实现AccountService接口的目标对象的任意连接点 （在Spring AOP中只是方法执行）：</span>
target（<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>xyz<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span>AccountService</span>） <span class="token comment">// 'target'在绑定表单中更加常用</span>

<span class="token comment">// 任何一个只接受一个参数，并且运行时所传入的参数是Serializable 接口的连接点（在Spring AOP中只是方法执行）</span>
args（<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span>） <span class="token comment">// 'args'在绑定表单中更加常用; 请注意在例子中给出的切入点不同于 execution(* *(java.io.Serializable))： args版本只有在动态运行时候传入参数是Serializable时才匹配，而execution版本在方法签名中声明只有一个 Serializable类型的参数时候匹配。</span>

<span class="token comment">// 目标对象中有一个 @Transactional 注解的任意连接点 （在Spring AOP中只是方法执行）</span>
<span class="token annotation punctuation">@target</span>（<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span>Transactional</span>）<span class="token comment">// '@target'在绑定表单中更加常用</span>

<span class="token comment">// 任何一个目标对象声明的类型有一个 @Transactional 注解的连接点 （在Spring AOP中只是方法执行）：</span>
<span class="token annotation punctuation">@within</span>（<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span>Transactional</span>） <span class="token comment">// '@within'在绑定表单中更加常用</span>

<span class="token comment">// 任何一个执行的方法有一个 @Transactional 注解的连接点 （在Spring AOP中只是方法执行）</span>
<span class="token annotation punctuation">@annotation</span>（<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span>Transactional</span>） <span class="token comment">// '@annotation'在绑定表单中更加常用</span>

<span class="token comment">// 任何一个只接受一个参数，并且运行时所传入的参数类型具有@Classified 注解的连接点（在Spring AOP中只是方法执行）</span>
<span class="token annotation punctuation">@args</span>（<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>xyz<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span>Classified</span>） <span class="token comment">// '@args'在绑定表单中更加常用</span>

<span class="token comment">// 任何一个在名为'tradeService'的Spring bean之上的连接点 （在Spring AOP中只是方法执行）</span>
bean（tradeService）

<span class="token comment">// 任何一个在名字匹配通配符表达式'*Service'的Spring bean之上的连接点 （在Spring AOP中只是方法执行）</span>
bean（<span class="token operator">*</span><span class="token class-name">Service</span>）
</code></pre></div><p>此外Spring 支持如下三个逻辑运算符来组合切入点表达式</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token operator">&amp;&amp;</span>：要求连接点同时匹配两个切入点表达式
<span class="token operator">||</span>：要求连接点匹配任意个切入点表达式
<span class="token operator">!</span><span class="token operator">:</span>：要求连接点不匹配指定的切入点表达式
</code></pre></div><h3 id="spring-aop-和-aspectj-之间的关键区别"><a href="#spring-aop-和-aspectj-之间的关键区别" class="header-anchor">#</a> Spring AOP 和 AspectJ 之间的关键区别？</h3> <p>AspectJ可以做Spring AOP干不了的事情，<strong>它是AOP编程的完全解决方案，Spring AOP则致力于解决企业级开发中最普遍的AOP</strong>（方法织入）。</p> <p>下表总结了 Spring AOP 和 AspectJ 之间的关键区别:</p> <table><thead><tr><th>Spring AOP</th> <th>AspectJ</th></tr></thead> <tbody><tr><td>在纯 Java 中实现</td> <td>使用 Java 编程语言的扩展实现</td></tr> <tr><td>不需要单独的编译过程</td> <td>除非设置 LTW，否则需要 AspectJ 编译器 (ajc)</td></tr> <tr><td>只能使用运行时织入</td> <td>运行时织入不可用。支持编译时、编译后和加载时织入</td></tr> <tr><td>功能不强-仅支持方法级编织</td> <td>更强大 - 可以编织字段、方法、构造函数、静态初始值设定项、最终类/方法等......。</td></tr> <tr><td>只能在由 Spring 容器管理的 bean 上实现</td> <td>可以在所有域对象上实现</td></tr> <tr><td>仅支持方法执行切入点</td> <td>支持所有切入点</td></tr> <tr><td>代理是由目标对象创建的, 并且切面应用在这些代理上</td> <td>在执行应用程序之前 (在运行时) 前, 各方面直接在代码中进行织入</td></tr> <tr><td>比 AspectJ 慢多了</td> <td>更好的性能</td></tr> <tr><td>易于学习和应用</td> <td>相对于 Spring AOP 来说更复杂</td></tr></tbody></table> <h3 id="spring-aop还是完全用aspectj"><a href="#spring-aop还是完全用aspectj" class="header-anchor">#</a> Spring AOP还是完全用AspectJ？</h3> <p>以下Spring官方的回答：（总结来说就是 <strong>Spring AOP更易用，AspectJ更强大</strong>）。</p> <ul><li>Spring AOP比完全使用AspectJ更加简单， 因为它不需要引入AspectJ的编译器／织入器到你开发和构建过程中。 如果你<strong>仅仅需要在Spring bean上通知执行操作，那么Spring AOP是合适的选择</strong>。</li> <li>如果你需要通知domain对象或其它没有在Spring容器中管理的任意对象，那么你需要使用AspectJ。</li> <li>如果你想通知除了简单的方法执行之外的连接点（如：调用连接点、字段get或set的连接点等等）， 也需要使用AspectJ。</li></ul> <hr></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/ifan/Notes/JVM/Spring/Spring基础 - Spring核心之控制反转(IOC).html" class="prev">
        Spring基础 - Spring核心之控制反转(IOC)
      </a></span> <span class="next"><a href="/ifan/Notes/计算机网络/TCP.html">
        TCP
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/ifan/assets/js/app.c758c43a.js" defer></script><script src="/ifan/assets/js/2.733019b2.js" defer></script><script src="/ifan/assets/js/20.f3544a96.js" defer></script>
  </body>
</html>
